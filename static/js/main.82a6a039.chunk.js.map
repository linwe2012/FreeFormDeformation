{"version":3,"sources":["canvas.js","traceballctrl.js","render.tsx","bits.tsx","personal_page.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["CanvasManager","frame","canvas","render","onresize","w","h","pickPosition","x","y","this","clearPickPosition","clientWidth","clientHeight","appendChild","mouseout","window","addEventListener","e","event","rect","getBoundingClientRect","clientX","left","clientY","top","pos","getCanvasRelativePosition","fn","onmousemove","onmousedown","onmouseup","onclick","TrackballControls","object","domElement","_this","STATE","undefined","document","enabled","screen","width","height","rotateSpeed","zoomSpeed","panSpeed","noRotate","noZoom","noPan","staticMoving","dynamicDampingFactor","minDistance","maxDistance","Infinity","keys","mouseButtons","LEFT","MOUSE","ROTATE","MIDDLE","ZOOM","RIGHT","PAN","target","Vector3","EPS","lastPosition","lastZoom","_state","_keyState","_eye","_movePrev","Vector2","_moveCurr","_lastAxis","_lastAngle","_zoomStart","_zoomEnd","_touchZoomDistanceStart","_touchZoomDistanceEnd","_panStart","_panEnd","target0","clone","position0","position","up0","up","zoom0","zoom","changeEvent","type","startEvent","endEvent","handleResize","innerWidth","innerHeight","box","d","ownerDocument","documentElement","pageXOffset","clientLeft","pageYOffset","clientTop","getMouseOnScreen","vector","pageX","pageY","set","getMouseOnCircle","mousedown","preventDefault","stopPropagation","button","state","copy","mousemove","mouseup","dispatchEvent","removeEventListener","mousewheel","deltaMode","deltaY","touchstart","touches","length","dx","dy","Math","sqrt","touchmove","touchend","contextmenu","rotateCamera","angle","axis","quaternion","Quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","sub","normalize","crossVectors","setLength","add","setFromAxisAngle","applyQuaternion","zoomCamera","factor","isPerspectiveCamera","multiplyScalar","isOrthographicCamera","updateProjectionMatrix","console","warn","panCamera","mouseChange","objectUp","pan","lengthSq","scale_x","right","scale_y","bottom","cross","subVectors","checkDistances","addVectors","update","lookAt","distanceToSquared","reset","dispose","attachCallback","prototype","Object","create","EventDispatcher","constructor","Render","props","useState","handle","setHandle","useEffect","HandleResize","Resize","getElementById","scene","THREE","renderer","antialias","powerPreference","camera","Aspect","flatScene","flatCamera","currentScale","setSize","setClearColor","setPixelRatio","devicePixelRatio","z","log","control","ambientLight","light","plight","light1","light2","ctrlPoints","Array","objectScene","ctrlPointsGroup","Group","STUs","dimensions","tm","requestAnimationFrame","autoClear","axies","MakeOne","color","name","group","geometry","material","cylinder","matCone","geoCone","userData","cone","n","rotation","PI","axisLength","orthoAxis","axisCaster","lastAxis","params","Line","threshold","lastMouse","what","delta","setAxisColor","children","ev","setPickPosition","setFromCamera","hits","intersectObjects","parent","lastCtrlPoints","Set","clearSelected","forEach","m","mat","Color","reflectivity","clear","ctrlKey","moveRaycaster","MakeCtrlPoint","dims","gap","max","min","arr","i","j","k","UpdateCtrlPoints","remove","Box3","setFromObject","Check","a","b","v","xyz","dot","productRange","prd","C","ffdOnce","l","s","t","u","P","pow","X","coeff","ffd","stu","buf","Float32Array","attributes","r","needsUpdate","size","axis_proj","project","move","dst","fi","orginalBounding","ComputeSTUOnce","res","ComputeSTUOnceObj","push","array","loader","GLTFLoader","lastHepler","loadModel","path","scale","load","traverse","Mesh","BufferGeometry","helper","changeScene","metalness","roughness","mesh","updateCtrlDims","updateScene","RunAll","ctrlPointsDims","PrettoSlider","withStyles","root","thumb","backgroundColor","border","marginTop","marginLeft","boxShadow","active","valueLabel","track","borderRadius","rail","Slider","useStyles","makeStyles","theme","flexGrow","Right","maxHeight","overflowY","paddingLeft","paddingTop","spacing","slider","display","sliderGroup","FixedMaxWidth","thediv","useRef","wrap","current","style","ref","className","id","PersonalPage","href","src","alt","Labels","Selects","App","classes","setCtrlPointsDims","setScene","Grid","container","item","xs","FormControl","variant","fullWidth","InputLabel","htmlFor","Select","value","onChange","inputProps","map","idx","MenuItem","textAlign","Typography","valueLabelDisplay","onChangeCommitted","val","Number","defaultValue","Boolean","location","hostname","match","ReactDOM","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.82a6a039.chunk.js","sourcesContent":["// import * as THREE from 'three'\n\n// import { MapColorToDiscrete, BeginingPrime, Integration, ComputeTransformMatrix } from './utils'\n\n\nexport class CanvasManager {\n    canvas = null\n    w = 0\n    h = 0\n    pickPosition = {\n        x: 0,\n        y: 0\n    }\n    frame = null\n\n    constructor(frame, canvas, render, onresize) {\n        this.clearPickPosition()\n        this.canvas = canvas\n        this.w = frame.clientWidth\n        this.h = frame.clientHeight\n        frame.appendChild(canvas)\n        frame.mouseout = ()=> this.clearPickPosition()\n        this.frame = frame\n        window.addEventListener('resize', (e)=>{\n            this.w = this.frame.clientWidth\n            this.h = this.frame.clientHeight\n            // render.setSize(this.w, this.h)\n            onresize(this.w, this.h)\n        })\n    }\n    \n    set onmousemove(fn) {\n        this.frame.onmousemove = fn\n    }\n\n    set onmousedown(fn) {\n        this.frame.onmousedown = fn\n    }\n\n    set onmouseup(fn) {\n        this.frame.onmouseup = fn\n    }\n\n    set onclick(fn) {\n        this.frame.onclick = fn\n    }\n\n    Aspect() {\n        return this.w / this.h\n    }\n\n    getCanvasRelativePosition(event) {\n        const rect = this.canvas.getBoundingClientRect();\n        return {\n          x: event.clientX - rect.left,\n          y: event.clientY - rect.top,\n        };\n    }\n\n    setPickPosition(event) {\n        let pickPosition = this.pickPosition\n        const pos = this.getCanvasRelativePosition(event);\n        pickPosition.x = (pos.x / this.w) *  2 - 1;\n        pickPosition.y = (pos.y / this.h) * -2 + 1;  // note we flip Y\n    }\n\n    clearPickPosition() {\n        let pickPosition = this.pickPosition\n        pickPosition.x = -100000;\n        pickPosition.y = -100000;\n    }\n}","/**\n * @author Eberhard Graether / http://egraether.com/\n * @author Mark Lundin \t/ http://mark-lundin.com\n * @author Simone Manini / http://daron1337.github.io\n * @author Luca Antiga \t/ http://lantiga.github.io\n */\n\nimport {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tVector2,\n\tVector3\n} from \"three\";\n\nvar TrackballControls = function ( object, domElement ) {\n\n\tvar _this = this;\n\tvar STATE = { NONE: - 1, ROTATE: 0, ZOOM: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_ZOOM_PAN: 4 };\n\n\tthis.object = object;\n\tthis.domElement = ( domElement !== undefined ) ? domElement : document;\n\n\t// API\n\n\tthis.enabled = true;\n\n\tthis.screen = { left: 0, top: 0, width: 0, height: 0 };\n\n\tthis.rotateSpeed = 1.0;\n\tthis.zoomSpeed = 1.2;\n\tthis.panSpeed = 0.3;\n\n\tthis.noRotate = false;\n\tthis.noZoom = false;\n\tthis.noPan = false;\n\n\tthis.staticMoving = false;\n\tthis.dynamicDampingFactor = 0.2;\n\n\tthis.minDistance = 0;\n\tthis.maxDistance = Infinity;\n\n\tthis.keys = [ 65 /*A*/, 83 /*S*/, 68 /*D*/ ];\n\n\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.ZOOM, RIGHT: MOUSE.PAN };\n\n\t// internals\n\n\tthis.target = new Vector3();\n\n\tvar EPS = 0.000001;\n\n\tvar lastPosition = new Vector3();\n\tvar lastZoom = 1;\n\n\tvar _state = STATE.NONE,\n\t\t_keyState = STATE.NONE,\n\n\t\t_eye = new Vector3(),\n\n\t\t_movePrev = new Vector2(),\n\t\t_moveCurr = new Vector2(),\n\n\t\t_lastAxis = new Vector3(),\n\t\t_lastAngle = 0,\n\n\t\t_zoomStart = new Vector2(),\n\t\t_zoomEnd = new Vector2(),\n\n\t\t_touchZoomDistanceStart = 0,\n\t\t_touchZoomDistanceEnd = 0,\n\n\t\t_panStart = new Vector2(),\n\t\t_panEnd = new Vector2();\n\n\t// for reset\n\n\tthis.target0 = this.target.clone();\n\tthis.position0 = this.object.position.clone();\n\tthis.up0 = this.object.up.clone();\n\tthis.zoom0 = this.object.zoom;\n\n\t// events\n\n\tvar changeEvent = { type: 'change' };\n\tvar startEvent = { type: 'start' };\n\tvar endEvent = { type: 'end' };\n\n\n\t// methods\n\n\tthis.handleResize = function () {\n\n\t\tif ( this.domElement === document ) {\n\n\t\t\tthis.screen.left = 0;\n\t\t\tthis.screen.top = 0;\n\t\t\tthis.screen.width = window.innerWidth;\n\t\t\tthis.screen.height = window.innerHeight;\n\n\t\t} else {\n\n\t\t\tvar box = this.domElement.getBoundingClientRect();\n\t\t\t// adjustments come from similar code in the jquery offset() function\n\t\t\tvar d = this.domElement.ownerDocument.documentElement;\n\t\t\tthis.screen.left = box.left + window.pageXOffset - d.clientLeft;\n\t\t\tthis.screen.top = box.top + window.pageYOffset - d.clientTop;\n\t\t\tthis.screen.width = box.width;\n\t\t\tthis.screen.height = box.height;\n\n\t\t}\n\n\t};\n\n\tvar getMouseOnScreen = ( function () {\n\n\t\tvar vector = new Vector2();\n\n\t\treturn function getMouseOnScreen( pageX, pageY ) {\n\n\t\t\tvector.set(\n\t\t\t\t( pageX - _this.screen.left ) / _this.screen.width,\n\t\t\t\t( pageY - _this.screen.top ) / _this.screen.height\n\t\t\t);\n\n\t\t\treturn vector;\n\n\t\t};\n\n\t}() );\n\n\tvar getMouseOnCircle = ( function () {\n\n\t\tvar vector = new Vector2();\n\n\t\treturn function getMouseOnCircle( pageX, pageY ) {\n\n\t\t\tvector.set(\n\t\t\t\t( ( pageX - _this.screen.width * 0.5 - _this.screen.left ) / ( _this.screen.width * 0.5 ) ),\n\t\t\t\t( ( _this.screen.height + 2 * ( _this.screen.top - pageY ) ) / _this.screen.width ) // screen.width intentional\n\t\t\t);\n\n\t\t\treturn vector;\n\n\t\t};\n\n\t}() );\n\n\tthis.rotateCamera = ( function () {\n\n\t\tvar axis = new Vector3(),\n\t\t\tquaternion = new Quaternion(),\n\t\t\teyeDirection = new Vector3(),\n\t\t\tobjectUpDirection = new Vector3(),\n\t\t\tobjectSidewaysDirection = new Vector3(),\n\t\t\tmoveDirection = new Vector3(),\n\t\t\tangle;\n\n\t\treturn function rotateCamera() {\n\n\t\t\tmoveDirection.set( _moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0 );\n\t\t\tangle = moveDirection.length();\n\n\t\t\tif ( angle ) {\n\n\t\t\t\t_eye.copy( _this.object.position ).sub( _this.target );\n\n\t\t\t\teyeDirection.copy( _eye ).normalize();\n\t\t\t\tobjectUpDirection.copy( _this.object.up ).normalize();\n\t\t\t\tobjectSidewaysDirection.crossVectors( objectUpDirection, eyeDirection ).normalize();\n\n\t\t\t\tobjectUpDirection.setLength( _moveCurr.y - _movePrev.y );\n\t\t\t\tobjectSidewaysDirection.setLength( _moveCurr.x - _movePrev.x );\n\n\t\t\t\tmoveDirection.copy( objectUpDirection.add( objectSidewaysDirection ) );\n\n\t\t\t\taxis.crossVectors( moveDirection, _eye ).normalize();\n\n\t\t\t\tangle *= _this.rotateSpeed;\n\t\t\t\tquaternion.setFromAxisAngle( axis, angle );\n\n\t\t\t\t_eye.applyQuaternion( quaternion );\n\t\t\t\t_this.object.up.applyQuaternion( quaternion );\n\n\t\t\t\t_lastAxis.copy( axis );\n\t\t\t\t_lastAngle = angle;\n\n\t\t\t} else if ( ! _this.staticMoving && _lastAngle ) {\n\n\t\t\t\t_lastAngle *= Math.sqrt( 1.0 - _this.dynamicDampingFactor );\n\t\t\t\t_eye.copy( _this.object.position ).sub( _this.target );\n\t\t\t\tquaternion.setFromAxisAngle( _lastAxis, _lastAngle );\n\t\t\t\t_eye.applyQuaternion( quaternion );\n\t\t\t\t_this.object.up.applyQuaternion( quaternion );\n\n\t\t\t}\n\n\t\t\t_movePrev.copy( _moveCurr );\n\n\t\t};\n\n\t}() );\n\n\n\tthis.zoomCamera = function () {\n\n\t\tvar factor;\n\n\t\tif ( _state === STATE.TOUCH_ZOOM_PAN ) {\n\n\t\t\tfactor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\n\t\t\t_touchZoomDistanceStart = _touchZoomDistanceEnd;\n\n\t\t\tif ( _this.object.isPerspectiveCamera ) {\n\n\t\t\t\t_eye.multiplyScalar( factor );\n\n\t\t\t} else if ( _this.object.isOrthographicCamera ) {\n\n\t\t\t\t_this.object.zoom *= factor;\n\t\t\t\t_this.object.updateProjectionMatrix();\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tfactor = 1.0 + ( _zoomEnd.y - _zoomStart.y ) * _this.zoomSpeed;\n\n\t\t\tif ( factor !== 1.0 && factor > 0.0 ) {\n\n\t\t\t\tif ( _this.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t_eye.multiplyScalar( factor );\n\n\t\t\t\t} else if ( _this.object.isOrthographicCamera ) {\n\n\t\t\t\t\t_this.object.zoom /= factor;\n\t\t\t\t\t_this.object.updateProjectionMatrix();\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( _this.staticMoving ) {\n\n\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t} else {\n\n\t\t\t\t_zoomStart.y += ( _zoomEnd.y - _zoomStart.y ) * this.dynamicDampingFactor;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tthis.panCamera = ( function () {\n\n\t\tvar mouseChange = new Vector2(),\n\t\t\tobjectUp = new Vector3(),\n\t\t\tpan = new Vector3();\n\n\t\treturn function panCamera() {\n\n\t\t\tmouseChange.copy( _panEnd ).sub( _panStart );\n\n\t\t\tif ( mouseChange.lengthSq() ) {\n\n\t\t\t\tif ( _this.object.isOrthographicCamera ) {\n\n\t\t\t\t\tvar scale_x = ( _this.object.right - _this.object.left ) / _this.object.zoom / _this.domElement.clientWidth;\n\t\t\t\t\tvar scale_y = ( _this.object.top - _this.object.bottom ) / _this.object.zoom / _this.domElement.clientWidth;\n\n\t\t\t\t\tmouseChange.x *= scale_x;\n\t\t\t\t\tmouseChange.y *= scale_y;\n\n\t\t\t\t}\n\n\t\t\t\tmouseChange.multiplyScalar( _eye.length() * _this.panSpeed );\n\n\t\t\t\tpan.copy( _eye ).cross( _this.object.up ).setLength( mouseChange.x );\n\t\t\t\tpan.add( objectUp.copy( _this.object.up ).setLength( mouseChange.y ) );\n\n\t\t\t\t_this.object.position.add( pan );\n\t\t\t\t_this.target.add( pan );\n\n\t\t\t\tif ( _this.staticMoving ) {\n\n\t\t\t\t\t_panStart.copy( _panEnd );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_panStart.add( mouseChange.subVectors( _panEnd, _panStart ).multiplyScalar( _this.dynamicDampingFactor ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t}() );\n\n\tthis.checkDistances = function () {\n\n\t\tif ( ! _this.noZoom || ! _this.noPan ) {\n\n\t\t\tif ( _eye.lengthSq() > _this.maxDistance * _this.maxDistance ) {\n\n\t\t\t\t_this.object.position.addVectors( _this.target, _eye.setLength( _this.maxDistance ) );\n\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t}\n\n\t\t\tif ( _eye.lengthSq() < _this.minDistance * _this.minDistance ) {\n\n\t\t\t\t_this.object.position.addVectors( _this.target, _eye.setLength( _this.minDistance ) );\n\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tthis.update = function () {\n\n\t\t_eye.subVectors( _this.object.position, _this.target );\n\n\t\tif ( ! _this.noRotate ) {\n\n\t\t\t_this.rotateCamera();\n\n\t\t}\n\n\t\tif ( ! _this.noZoom ) {\n\n\t\t\t_this.zoomCamera();\n\n\t\t}\n\n\t\tif ( ! _this.noPan ) {\n\n\t\t\t_this.panCamera();\n\n\t\t}\n\n\t\t_this.object.position.addVectors( _this.target, _eye );\n\n\t\tif ( _this.object.isPerspectiveCamera ) {\n\n\t\t\t_this.checkDistances();\n\n\t\t\t_this.object.lookAt( _this.target );\n\n\t\t\tif ( lastPosition.distanceToSquared( _this.object.position ) > EPS ) {\n\n\t\t\t\t_this.dispatchEvent( changeEvent );\n\n\t\t\t\tlastPosition.copy( _this.object.position );\n\n\t\t\t}\n\n\t\t} else if ( _this.object.isOrthographicCamera ) {\n\n\t\t\t_this.object.lookAt( _this.target );\n\n\t\t\tif ( lastPosition.distanceToSquared( _this.object.position ) > EPS ||Â lastZoom !== _this.object.zoom ) {\n\n\t\t\t\t_this.dispatchEvent( changeEvent );\n\n\t\t\t\tlastPosition.copy( _this.object.position );\n\t\t\t\tlastZoom = _this.object.zoom;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t}\n\n\t};\n\n\tthis.reset = function () {\n\n\t\t_state = STATE.NONE;\n\t\t_keyState = STATE.NONE;\n\n\t\t_this.target.copy( _this.target0 );\n\t\t_this.object.position.copy( _this.position0 );\n\t\t_this.object.up.copy( _this.up0 );\n\t\t_this.object.zoom = _this.zoom0;\n\n\t\t_this.object.updateProjectionMatrix();\n\n\t\t_eye.subVectors( _this.object.position, _this.target );\n\n\t\t_this.object.lookAt( _this.target );\n\n\t\t_this.dispatchEvent( changeEvent );\n\n\t\tlastPosition.copy( _this.object.position );\n\t\tlastZoom = _this.object.zoom;\n\n\t};\n\n\t// listeners\n\n\tfunction mousedown( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif ( _state === STATE.NONE ) {\n\n\t\t\tswitch ( event.button ) {\n\n\t\t\t\tcase _this.mouseButtons.LEFT:\n\t\t\t\t\t_state = STATE.ROTATE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase _this.mouseButtons.MIDDLE:\n\t\t\t\t\t_state = STATE.ZOOM;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase _this.mouseButtons.RIGHT:\n\t\t\t\t\t_state = STATE.PAN;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t_state = STATE.NONE;\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\n\n\t\tif ( state === STATE.ROTATE && ! _this.noRotate ) {\n\n\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\t\t\t_movePrev.copy( _moveCurr );\n\n\t\t} else if ( state === STATE.ZOOM && ! _this.noZoom ) {\n\n\t\t\t_zoomStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\t\t\t_zoomEnd.copy( _zoomStart );\n\n\t\t} else if ( state === STATE.PAN && ! _this.noPan ) {\n\n\t\t\t_panStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\t\t\t_panEnd.copy( _panStart );\n\n\t\t}\n\n\t\tdocument.addEventListener( 'mousemove', mousemove, false );\n\t\tdocument.addEventListener( 'mouseup', mouseup, false );\n\n\t\t_this.dispatchEvent( startEvent );\n\n\t}\n\n\tfunction mousemove( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tvar state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\n\n\t\tif ( state === STATE.ROTATE && ! _this.noRotate ) {\n\n\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\n\t\t} else if ( state === STATE.ZOOM && ! _this.noZoom ) {\n\n\t\t\t_zoomEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\n\t\t} else if ( state === STATE.PAN && ! _this.noPan ) {\n\n\t\t\t_panEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\n\t\t}\n\n\t}\n\n\tfunction mouseup( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\t_state = STATE.NONE;\n\n\t\tdocument.removeEventListener( 'mousemove', mousemove );\n\t\tdocument.removeEventListener( 'mouseup', mouseup );\n\t\t_this.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction mousewheel( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tif ( _this.noZoom === true ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tswitch ( event.deltaMode ) {\n\n\t\t\tcase 2:\n\t\t\t\t// Zoom in pages\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.025;\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\t// Zoom in lines\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.01;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t// undefined, 0, assume pixels\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.00025;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t_this.dispatchEvent( startEvent );\n\t\t_this.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction touchstart( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1:\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\tbreak;\n\n\t\t\tdefault: // 2 or more\n\t\t\t\t_state = STATE.TOUCH_ZOOM_PAN;\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\t\t\t\t_touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\n\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\n\t\t\t\t_panStart.copy( getMouseOnScreen( x, y ) );\n\t\t\t\t_panEnd.copy( _panStart );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t_this.dispatchEvent( startEvent );\n\n\t}\n\n\tfunction touchmove( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1:\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\tbreak;\n\n\t\t\tdefault: // 2 or more\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\t\t\t\t_touchZoomDistanceEnd = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\n\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\n\t\t\t\t_panEnd.copy( getMouseOnScreen( x, y ) );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\tfunction touchend( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 0:\n\t\t\t\t_state = STATE.NONE;\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t_this.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction contextmenu( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t}\n\n\tthis.dispose = function () {\n\n\t\tthis.domElement.removeEventListener( 'contextmenu', contextmenu, false );\n\t\tthis.domElement.removeEventListener( 'mousedown', mousedown, false );\n\t\tthis.domElement.removeEventListener( 'wheel', mousewheel, false );\n\n\t\tthis.domElement.removeEventListener( 'touchstart', touchstart, false );\n\t\tthis.domElement.removeEventListener( 'touchend', touchend, false );\n\t\tthis.domElement.removeEventListener( 'touchmove', touchmove, false );\n\n\t\tdocument.removeEventListener( 'mousemove', mousemove, false );\n\t\tdocument.removeEventListener( 'mouseup', mouseup, false );\n\n\t\t// window.removeEventListener( 'keydown', keydown, false );\n\t\t// window.removeEventListener( 'keyup', keyup, false );\n\n\t};\n\n\n\tthis.attachCallback = function () {\n\t\tthis.domElement.addEventListener( 'contextmenu', contextmenu, false );\n\t\tthis.domElement.addEventListener( 'mousedown', mousedown, false );\n\t\tthis.domElement.addEventListener( 'wheel', mousewheel, false );\n\n\t\tthis.domElement.addEventListener( 'touchstart', touchstart, false );\n\t\tthis.domElement.addEventListener( 'touchend', touchend, false );\n\t\tthis.domElement.addEventListener( 'touchmove', touchmove, false );\n\t}\n\n\tthis.attachCallback()\n\t//this.domElement.addEventListener( 'contextmenu', contextmenu, false );\n\t//this.domElement.addEventListener( 'mousedown', mousedown, false );\n\t//this.domElement.addEventListener( 'wheel', mousewheel, false );\n\n\t//this.domElement.addEventListener( 'touchstart', touchstart, false );\n\t//this.domElement.addEventListener( 'touchend', touchend, false );\n\t//this.domElement.addEventListener( 'touchmove', touchmove, false );\n\n\t// window.addEventListener( 'keydown', keydown, false );\n\t// window.addEventListener( 'keyup', keyup, false );\n\n\tthis.handleResize();\n\n\t// force an update at start\n\tthis.update();\n\n};\n\nTrackballControls.prototype = Object.create( EventDispatcher.prototype );\nTrackballControls.prototype.constructor = TrackballControls;\n\nexport { TrackballControls };\n","import React, { useEffect, useState } from 'react'\nimport { CanvasManager } from './canvas'\nimport * as THREE from 'three'\nimport { TrackballControls } from './traceballctrl'\n//import { TrackballControls } from 'three/examples/jsm/controls/TrackballControls'\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\nimport { Box3, Group, Mesh, BufferGeometry, BufferAttribute, MeshBasicMaterial, Color } from 'three'\n// import { DragControls } from 'three/examples/jsm/controls/DragControls'\n\ninterface RenderProps {\n    ctrlPointsDims: [number, number, number]\n    scene:string\n}\n\ninterface STU {\n    object: Mesh\n    stu: Float32Array\n}\n\nconst Render : React.FC<RenderProps> = (props)=>{\n    const [handle, setHandle] = useState<ReturnType<typeof RunAll>>()\n    useEffect(()=>{\n        setHandle(RunAll())\n    }, [])\n\n    // eslint-disable: react-hooks/exhaustive-deps\n    useEffect(()=>{\n        if(handle){\n            const dims = props.ctrlPointsDims\n            handle.updateCtrlDims(...dims)\n        }\n    }, [props.ctrlPointsDims])\n\n    // eslint-disable-next-line\n    useEffect(()=>{\n        if(handle) {\n            handle.updateScene(props.scene)\n        }\n    }, [props.scene])\n\n    return (null)\n}\n\nexport default Render;\n\n\n\nfunction RunAll () {\nconst HandleResize = ()=>{Resize()}\nconst frame = document.getElementById('canvas-frame'); if(frame === null) return;\nconst scene = new THREE.Scene();\nconst renderer = new THREE.WebGLRenderer({antialias : true, powerPreference:'high-performance'});\nconst canvas = new CanvasManager(frame, renderer.domElement, renderer, HandleResize);\nconst camera = new THREE.PerspectiveCamera(75, canvas.Aspect(), 0.1, 1000);\nconst flatScene = new THREE.Scene()\nconst flatCamera = new THREE.PerspectiveCamera(75, canvas.Aspect(), 0.1, 1000);\nlet currentScale = 0.1\n\nrenderer.setSize(canvas.w, canvas.h);\nrenderer.setClearColor(0x444444, 1.0);\nrenderer.setPixelRatio(window.devicePixelRatio)\n\ncamera.position.z = 5;\nflatCamera.position.z = 5\nvar Resize=() => {\n    console.log(canvas.w, canvas.h)\n    // camera.aspect = canvas.Aspect()\n    // camera.updateMatrix()\n}\nconst control = new TrackballControls(camera, frame)\n// const fpControl = new KeyControls(camera, frame)\ncontrol.target.set(0, 0, 0)\ncontrol.rotateSpeed = 8.0;\ncontrol.noPan = false\ncontrol.maxDistance = 60\ncontrol.keys = []\ncontrol.dispose()\nconst ambientLight = new THREE.AmbientLight( 0x404040 ); // soft white light\nscene.add( ambientLight );\nvar light = new THREE.PointLight( 0xffffff, 1, 100 );\nlight.position.set( 10, 10, 10 );\nscene.add( light );\n\nvar plight = new THREE.PointLight( 0xffffff, 1, 200 );\nplight.position.set( -40, 20, 20 );\nscene.add( plight );\n\nvar light1 = new THREE.PointLight( 0xffffff, 1, 200 );\nlight1.position.set( -40, -20, -20 );\nscene.add( light1 );\n\nvar light2 = new THREE.PointLight( 0xffffff, 1, 200 );\nlight2.position.set( -20, 10, -10 );\nscene.add( light2 );\n\nlet ctrlPoints = new Array<Array<Array<THREE.Vector3>>>()\nlet objectScene : THREE.Scene | THREE.Object3D | null = null\nlet ctrlPointsGroup = new Group()\nlet STUs = new Array<STU>()\nlet dimensions = new THREE.Vector3(2, 2, 2)\n// let bounding = new Box3()\n\nscene.add(ctrlPointsGroup)\n\nfunction render(tm : number) {\n    requestAnimationFrame(render);\n    renderer.autoClear = true;\n    renderer.render(scene, camera);\n    renderer.autoClear = false;\n    renderer.render(flatScene, flatCamera)\n    // fpControl.update(tm - lastTm)\n    control.update();\n}\nrender(0);\n\nconst axies = new THREE.Group()\nscene.add(axies)\n\nconst MakeOne = (x: number, y: number, z: number, color: number, name ?: string)=>{\n    const group = new THREE.Group();\n    var geometry = new THREE.CylinderGeometry( 0.015, 0.015, x||y||z, 3 );\n    var material = new THREE.MeshBasicMaterial( {color: color} );\n    var cylinder = new THREE.Mesh( geometry, material );\n    cylinder.position.set(x/2,y/2,z/2)\n    \n    const matCone = new THREE.ConeGeometry( 0.05, 0.1, 6 );\n    \n    const geoCone = new THREE.MeshBasicMaterial( {color: color} );\n    cylinder.userData = { name: name, color:color, axis: new THREE.Vector3(x, y, z) }\n\n    const cone = new THREE.Mesh( matCone, geoCone );\n    cone.position.set(x, y, z)\n    const n = cone.position.clone().normalize()\n    cone.rotation.set(n.z * Math.PI / 2, n.y * Math.PI / 2, -n.x * Math.PI / 2)\n    cone.userData = { name: name, color:color, axis: new THREE.Vector3(x, y, z) }\n    cylinder.rotation.set(n.z * Math.PI / 2, n.y * Math.PI / 2, -n.x * Math.PI / 2)\n    \n    group.userData = { name: name, color:color, axis: new THREE.Vector3(x, y, z) }\n    group.add(cylinder, cone)\n    return group;\n}\n\nconst axisLength = 0.6 as const\n\n{\n    const group = MakeOne(axisLength, 0, 0, 0xffff00, 'x')\n    axies.add(group)\n}\n{\n    const group = MakeOne(0, axisLength, 0, 0xff00ff, 'y')\n    axies.add(group)\n}\n{\n    const group = MakeOne(0, 0, axisLength, 0x00aaff, 'z')\n    axies.add(group)\n}\n\nconst orthoAxis = new THREE.Group()\n\nflatScene.add(orthoAxis)\n{\n    const group = MakeOne(1, 0, 0, 0xffff00)\n    orthoAxis.add(group)\n}\n{\n    const group = MakeOne(0, 1, 0, 0xff00ff)\n    orthoAxis.add(group)\n}\n{\n    const group = MakeOne(0, 0, 0.5, 0x00aaff)\n    orthoAxis.add(group)\n}\northoAxis.position.set(-6 * canvas.Aspect(), -6 , -4.6)\n\nconst axisCaster = new THREE.Raycaster()\nlet lastAxis : THREE.Group | null = null\n// axisCaster.linePrecision = 0.05;\n// axisCaster.params = { Line: { threshold: 100 } }\naxisCaster.params.Line = { threshold:5 }\nlet mousedown = false\nlet lastMouse = {\n    x: 0,\n    y: 0,\n    update: (what:{x:number,y:number}) => {\n        let delta = new THREE.Vector3(\n            what.x - lastMouse.x,\n            what.y - lastMouse.y\n        )\n        lastMouse.x = what.x\n        lastMouse.y = what.y\n        return delta;\n    },\n    clone: () => {\n        return {\n            x: lastMouse.x,\n            y: lastMouse.y\n        }\n    }\n}\n\nconst setAxisColor = (color:number) => {\n    if(!lastAxis) return;\n    ((lastAxis.children[0] as Mesh).material as MeshBasicMaterial).color.set( color );\n    ((lastAxis.children[1] as Mesh).material as MeshBasicMaterial).color.set( color );\n}\n\n\n//frame.onmousedown \n\nconst onmousedown = (ev:MouseEvent)=>{\n    console.log('On mouse down')\n    mousedown = true\n    canvas.setPickPosition(ev)\n    lastMouse.update(canvas.pickPosition)\n    axisCaster.setFromCamera(canvas.pickPosition, camera);\n    const hits = axisCaster.intersectObjects(axies.children, true)\n    if(lastAxis !== null) {\n        setAxisColor( lastAxis.userData.color );\n        lastAxis = null\n    }\n    if(hits.length) {\n        control.enabled = false;\n        lastAxis = hits[0].object.parent as Group;\n        setAxisColor( 0xffffff );\n    }\n}\nframe.onmousedown = onmousedown\n\nlet lastCtrlPoints = new Set<Mesh>()\n\nconst clearSelected = ()=>{\n    lastCtrlPoints.forEach(m=>{\n        const mat = (m.material as THREE.MeshLambertMaterial);\n        // mat.emissive = new THREE.Color(0xbbbbbb);\n        mat.color = new Color(0x999999)\n        mat.reflectivity = 1\n    });\n    lastCtrlPoints.clear()\n}\n\n\nframe.onclick = (ev)=>{\n    canvas.setPickPosition(ev)\n    axisCaster.setFromCamera(canvas.pickPosition, camera);\n    const hits = axisCaster.intersectObjects(ctrlPointsGroup.children)\n    if(hits.length) {\n        if(!ev.ctrlKey) {\n            clearSelected()   \n        }\n        lastCtrlPoints.add(hits[0].object as Mesh);\n        const mat  = (hits[0].object as THREE.Mesh).material as THREE.MeshLambertMaterial;\n        // mat.emissive = new THREE.Color(0x99ffee);\n        mat.color = new Color(0xbb44ff)\n        mat.reflectivity = 1.4\n        const pos = hits[0].object.position\n        axies.position.set(pos.x, pos.y, pos.z)\n    }\n}\n\nconst moveRaycaster = new THREE.Raycaster();\n\nframe.onmousemove = (ev)=>{\n    if(lastAxis === null || !mousedown || !lastCtrlPoints.size) {\n        return\n    }\n    canvas.setPickPosition(ev)\n    const delta = lastMouse.update(canvas.pickPosition)\n    if(delta.length() === 0) return;\n    const axis = lastAxis.userData.axis as THREE.Vector3\n    const axis_proj = axis.clone().project(camera);\n    //const axis_proj2d = axis_proj.clone();\n    axis_proj.z = 0\n\n    moveRaycaster.setFromCamera(canvas.pickPosition, camera);\n\n    const raw_move = axis_proj.dot(delta) / axis_proj.length();\n    //const dst = axis_proj2d.multiplyScalar(raw_move).add(axis_proj);\n\n    ///axis_proj.x += axis_proj2d.x\n    //axis_proj.y += axis_proj2d.y\n    //const dst = axis_proj.unproject(camera);\n    //axies.position.set(dst.x, dst.y, dst.z);\n\n    const move = raw_move * (axisLength / axis_proj.length()) * 0.76;\n    const dst = axis.clone().multiplyScalar(move); // move direction vector\n    \n    // dst.add(axies.position)\n    \n    axies.position.add(dst);\n\n    lastCtrlPoints.forEach(m=>{\n        m.position.add(dst)\n        const fi = m.position;\n        const xyz = m.userData.xyz\n        ctrlPoints[xyz[0]][xyz[1]][xyz[2]].set(fi.x, fi.y, fi.z);\n    })\n    ffd();\n}\n\nframe.onmouseup = (ev)=>{\n    mousedown = false\n    control.enabled = true\n    if(lastAxis !== null) {\n        setAxisColor( lastAxis.userData.color )\n        \n        lastAxis = null\n    }\n}\n\nfunction MakeCtrlPoint(dims : THREE.Vector3, box : THREE.Box3, fn: (v:THREE.Vector3, xyz: number[])=>any) {\n    const gap = box.max.clone().sub(box.min)\n    const arr = new Array<Array<Array<THREE.Vector3>>>()\n    \n    for(let i = 0; i < dims.x + 1; ++i) {\n        arr[i] = new Array<Array<THREE.Vector3>>()\n        for(let j = 0; j < dims.y + 1; ++j) {\n            arr[i][j] = new Array<THREE.Vector3>()\n            for(let k = 0; k < dims.z + 1; ++k) {\n                arr[i][j][k] = new THREE.Vector3(\n                    gap.x / dims.x * i,\n                    gap.y / dims.y * j,\n                    gap.z / dims.z * k,\n                )\n                arr[i][j][k].add(box.min)\n                fn(arr[i][j][k], [i, j, k])\n            }\n        }\n    }\n    return arr\n}\n\n\n// children[0]: lines\n// children[1]: plane\n// const lattices = new THREE.Group();\n\nfunction UpdateCtrlPoints(dims : THREE.Vector3) {\n    if(objectScene === null) {\n        return\n    }\n\n    dimensions = dims\n    while (ctrlPointsGroup.children.length)\n    {\n        ctrlPointsGroup.remove(ctrlPointsGroup.children[0]);\n    }\n\n    let box = new Box3().setFromObject(objectScene);\n    console.log(box)\n    // bounding = box\n    const Check = (a : number, b : number)=>{\n        return a === 0 || a === b\n    }\n    ctrlPoints = MakeCtrlPoint(dims, box, (v, xyz)=>{\n        if(!(Check(xyz[0], dims.x) || Check(xyz[1], dims.y) || Check(xyz[2], dims.z))) return;\n        let geometry = new THREE.SphereGeometry(0.042, 16, 16)\n        let material = new THREE.MeshLambertMaterial({color:0xaaaaaa});\n        let dot = new THREE.Mesh(geometry, material)\n        dot.position.set(v.x, v.y, v.z)\n        dot.userData = { xyz: xyz }\n        ctrlPointsGroup.add(dot)\n    })\n}\n\nfunction productRange(a:number, b:number) {\n    let prd = a, i = a;\n    while(i++ < b) {\n        prd *= i\n    }\n    return prd\n}\n\nfunction C(n:number, k:number) {\n    k = (k < n-k) ? n-k : k // this must go first\n    if(n === k) return 1;\n    return productRange(k+1, n) / productRange(1, n-k)\n}\n\nfunction ffdOnce(l:number, m:number, n:number, s:number, t:number, u:number, P:THREE.Vector3[][][] /*ctrl point*/) {\n    const pow = Math.pow\n    const X = new THREE.Vector3(0,0,0)\n    for(let i = 0; i <= l; ++i) {\n        for(let j = 0; j <= m; ++j) {\n            for(let k = 0; k <= n; ++k) {\n                const coeff = \n                    C(l,i)*pow(1-s,l-i)*pow(s,i)* // bernstein\n                    C(m,j)*pow(1-t,m-j)*pow(t,j)*\n                    C(n,k)*pow(1-u,n-k)*pow(u,k)\n                X.add(P[i][j][k].clone().multiplyScalar(coeff))\n            }\n        }\n    }\n    X.multiplyScalar(1/currentScale)\n    return X\n}\n\nfunction ffd() {\n    for(let stu of STUs) {\n        let v = stu.stu\n        let buf = new Float32Array(v.length);\n        let pos = (stu.object.geometry as BufferGeometry).attributes.position as BufferAttribute;\n        \n        for(let i = 0; i < v.length; i+=3){\n            let r = ffdOnce(dimensions.x, dimensions.y, dimensions.z, v[i], v[i+1], v[i+2], ctrlPoints);\n            buf[i]   = r.x\n            buf[i+1] = r.y\n            buf[i+2] = r.z\n        }\n        pos.set(buf)\n        pos.needsUpdate = true\n    }\n}\n\nlet orginalBounding = new THREE.Box3()\n\nfunction ComputeSTUOnce(v : ArrayLike<number>, box:Box3) {\n    const res = new Float32Array(v.length)\n    const gap = box.max.clone().sub(box.min)\n    for(let i = 0; i < v.length;++i){\n        res[i] = (v[i] - box.min.x) / gap.x\n        ++i;\n        res[i] = (v[i] - box.min.y) / gap.y\n        ++i;\n        res[i] = (v[i] - box.min.z) / gap.z\n    }\n    return res\n}\n\nfunction ComputeSTUOnceObj(object:Mesh) {\n    STUs.push(\n        {\n            object: object,\n            stu: ComputeSTUOnce(((object.geometry as BufferGeometry).attributes.position as BufferAttribute).array, orginalBounding)\n        }\n    )\n}\n\nconst loader = new GLTFLoader()\nlet lastHepler: THREE.BoxHelper | null = null\nconst loadModel = (path:string, scale: number)=>{\n    loader.load(path, (m)=>{\n        if(objectScene) {\n            scene.remove(objectScene);\n        }\n        currentScale = scale\n        orginalBounding.setFromObject(m.scene)\n        m.scene.scale.set(scale, scale, scale)\n        scene.add(m.scene)\n        objectScene = m.scene\n        STUs = []\n        \n        m.scene.traverse(object=>{\n            if(object instanceof Mesh) {\n                if(object.geometry instanceof BufferGeometry) {\n                    ComputeSTUOnceObj(object);\n                }\n            }\n        })\n        if(lastHepler) scene.remove(lastHepler)\n\n        let helper = new THREE.BoxHelper(m.scene, new THREE.Color(0xaa3348));\n        helper.update();\n        scene.add(helper); \n        lastHepler = helper\n        UpdateCtrlPoints(dimensions)\n    })\n}\n\nconst changeScene = (what:string)=>{\n    if(what === 'book') {\n        loadModel('./book/scene.gltf', 0.1)\n    }\n    else if(what === 'car') {\n        loadModel('./car/scene.gltf', 0.003);\n    }\n    else {\n        if(lastHepler) scene.remove(lastHepler)\n        if(objectScene) scene.remove(objectScene);\n        const material = new THREE.MeshPhysicalMaterial( {color: 0x2194ce, metalness: 0.5, roughness: 0.6 } );\n        let geometry: THREE.BufferGeometry | null = null\n        if(what === 'sphere') {\n            geometry = new THREE.SphereBufferGeometry( 0.5, 64, 64 );\n        }\n        else if (what === 'cube') {\n            geometry = new THREE.BoxBufferGeometry(1, 1, 1, 8, 8, 8);\n        }\n        else if(what === 'cylinder') {\n            geometry = new THREE.CylinderBufferGeometry( 0.5, 0.5, 1, 32 );\n        }\n        else if(what === 'donut') {\n            geometry = new THREE.TorusBufferGeometry( 0.5, 0.25, 16, 100 );\n        }\n        else {\n            return;\n        }\n        const mesh = new THREE.Mesh( geometry, material );\n        orginalBounding.setFromObject(mesh);\n        objectScene = mesh\n        UpdateCtrlPoints(dimensions)\n        STUs=[]\n        ComputeSTUOnceObj(mesh)\n        currentScale = 1\n        scene.add( mesh );\n    }\n    \n}\n\nchangeScene('book')\ncontrol.attachCallback()\n\nreturn {\n    updateCtrlDims: (x:number, y:number, z:number)=> UpdateCtrlPoints(new THREE.Vector3(x, y, z)),\n    updateScene: (x:string)=>changeScene(x),\n    reset: ()=>{ UpdateCtrlPoints(dimensions); ffd(); }\n}\n\n}","\nimport React, { useRef, useEffect } from 'react';\nimport Slider from '@material-ui/core/Slider';\nimport { withStyles, makeStyles } from '@material-ui/core/styles';\n\nexport const PrettoSlider = withStyles({\n    root: {\n      color: '#52af77',\n      height: 8,\n    },\n    thumb: {\n      height: 24,\n      width: 24,\n      backgroundColor: '#fff',\n      border: '2px solid currentColor',\n      marginTop: -8,\n      marginLeft: -12,\n      '&:focus,&:hover,&$active': {\n        boxShadow: 'inherit',\n      },\n    },\n    active: {},\n    valueLabel: {\n      left: 'calc(-50% + 4px)',\n    },\n    track: {\n      height: 8,\n      borderRadius: 4,\n    },\n    rail: {\n      height: 8,\n      borderRadius: 4,\n    },\n  })(Slider);\n\n\nexport const useStyles = makeStyles(theme => ({\n    root: {\n      flexGrow: 1,\n    },\n    Right: {\n        maxHeight: '100vh',\n        overflowY: 'scroll',\n        paddingLeft: 20,\n        paddingTop: theme.spacing(2)\n    },\n    slider: {\n        display: 'inline'\n    },\n    sliderGroup:{\n      marginTop: theme.spacing(3)\n    }\n}))\n\nconst FixedMaxWidth:React.FC =  (props)=>{\n    const thediv = useRef<HTMLDivElement>(null)\n    const wrap = useRef<HTMLDivElement>(null)\n    useEffect(()=>{\n        if(thediv.current && wrap.current) {\n            thediv.current.style.width = wrap.current.style.width\n        }\n      \n    }, [])\n    return(\n      <div ref={wrap} className='canvas-frame-wrapper'>\n        <div ref={thediv} id=\"canvas-frame\" className=\"canvas-frame\"></div>\n        {props.children}\n      </div>\n    )\n  }\n\nexport { FixedMaxWidth }\n","import React from 'react'\nimport './personal_page.css'\n\n\nconst PersonalPage:React.FC = () =>{\n    return (\n        <a href='https://linwe2012.github.io/personal-page'>\n        <div className='personal-page-wrap-white'>\n            <img className='personal-page-avatar-white' src='https://linwe2012.github.io/personal-page/static/img/me-removebg-preview-sqr.svg' alt=''></img>\n            <div className='personal-page-text-white'>Lin's Personal Page</div>\n        </div>\n        </a>\n    )\n}\n\nexport default PersonalPage;","import React, { useState } from 'react';\nimport './App.css';\nimport Render from './render'\n\nimport { PrettoSlider, useStyles, FixedMaxWidth } from './bits'\nimport Grid from '@material-ui/core/Grid'\nimport Typography from '@material-ui/core/Typography';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport PersonalPage from './personal_page'\n\nconst Labels = [\n  'Lattice X', 'Lattice Y', 'Lattice Z'\n] as const\n\nconst Selects = [\n  'book', 'car', 'sphere', 'cube', 'donut'\n] as const\n\nconst App: React.FC = () => {\n  const classes = useStyles()\n  const [ctrlPointsDims, setCtrlPointsDims] = useState<[number, number, number]>([2, 2, 2])\n  const [scene, setScene] = useState(0)\n  return (\n    <div className=\"App\">\n      <Grid container className={classes.root}>\n        <Grid item xs={9}>\n        <FixedMaxWidth>\n        <Render \n          ctrlPointsDims={ctrlPointsDims}\n          scene={Selects[scene]}\n        />\n        </FixedMaxWidth>\n      </Grid>\n      <Grid item xs={3} className={classes.Right}>\n      \n      <a href='https://github.com/linwe2012/FreeFormDeformation'>Github Source Code</a> <p></p>\n      <a href='https://people.eecs.berkeley.edu/~sequin/CS285/PAPERS/Sederberg_Parry.pdf'>[PDF] Free-Form Deformation of Solid Geometric Models</a>\n      <p></p>\n      <p></p>\n      <FormControl variant=\"filled\" fullWidth>\n        <InputLabel htmlFor=\"filled-scene\">Scene</InputLabel>\n        <Select\n          value={scene}\n          onChange={(e: any)=>setScene(e.target.value)}\n          inputProps={{\n            name: 'scene',\n            id: 'filled-scene',\n          }}\n        >\n          {\n            Selects.map((v, idx)=>{return (\n              <MenuItem key={idx} value={idx}>{v}</MenuItem>\n            )})\n          }\n        </Select>\n      </FormControl>\n        <div className={classes.sliderGroup}>\n        {\n          ctrlPointsDims.map((v, idx)=>{return (\n            <div style={{textAlign:'left'}} key={idx}>\n            <Typography display='inline'>\n              {Labels[idx]}\n            </Typography>\n            <PrettoSlider \n              valueLabelDisplay=\"auto\" \n              \n              onChangeCommitted={(e:any, val)=>{\n                const arr = [...ctrlPointsDims] as [number, number, number]\n                arr[idx] = Number(val)\n                setCtrlPointsDims(arr)\n              }} \n              defaultValue={2} \n              min={1} max={10}\n            />\n            </div>\n          )})\n        }\n        </div>\n        <PersonalPage></PersonalPage>\n      </Grid>\n      </Grid>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}