{"version":3,"sources":["canvas.js","traceballctrl.js","render.tsx","bits.tsx","personal_page.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["CanvasManager","frame","canvas","render","onresize","w","h","pickPosition","x","y","this","clearPickPosition","clientWidth","clientHeight","appendChild","mouseout","window","addEventListener","e","event","rect","getBoundingClientRect","clientX","left","clientY","top","pos","getCanvasRelativePosition","fn","onmousemove","onmousedown","onmouseup","onclick","TrackballControls","object","domElement","_this","STATE","undefined","document","enabled","screen","width","height","rotateSpeed","zoomSpeed","panSpeed","noRotate","noZoom","noPan","staticMoving","dynamicDampingFactor","minDistance","maxDistance","Infinity","keys","mouseButtons","LEFT","MOUSE","ROTATE","MIDDLE","ZOOM","RIGHT","PAN","target","Vector3","EPS","lastPosition","lastZoom","_state","_keyState","_eye","_movePrev","Vector2","_moveCurr","_lastAxis","_lastAngle","_zoomStart","_zoomEnd","_touchZoomDistanceStart","_touchZoomDistanceEnd","_panStart","_panEnd","target0","clone","position0","position","up0","up","zoom0","zoom","changeEvent","type","startEvent","endEvent","handleResize","innerWidth","innerHeight","box","d","ownerDocument","documentElement","pageXOffset","clientLeft","pageYOffset","clientTop","getMouseOnScreen","vector","pageX","pageY","set","getMouseOnCircle","mousedown","preventDefault","stopPropagation","button","state","copy","mousemove","mouseup","dispatchEvent","removeEventListener","mousewheel","deltaMode","deltaY","touchstart","touches","length","dx","dy","Math","sqrt","touchmove","touchend","contextmenu","rotateCamera","angle","axis","quaternion","Quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","sub","normalize","crossVectors","setLength","add","setFromAxisAngle","applyQuaternion","zoomCamera","factor","isPerspectiveCamera","multiplyScalar","isOrthographicCamera","updateProjectionMatrix","console","warn","panCamera","mouseChange","objectUp","pan","lengthSq","scale_x","right","scale_y","bottom","cross","subVectors","checkDistances","addVectors","update","lookAt","distanceToSquared","reset","dispose","attachCallback","prototype","Object","create","EventDispatcher","constructor","Render","props","useState","handle","setHandle","useEffect","HandleResize","Resize","getElementById","scene","THREE","renderer","antialias","powerPreference","camera","Aspect","flatScene","flatCamera","currentScale","setSize","setClearColor","z","log","control","ambientLight","light","plight","light1","light2","ctrlPoints","Array","objectScene","ctrlPointsGroup","Group","STUs","dimensions","tm","requestAnimationFrame","autoClear","axies","MakeOne","color","name","group","geometry","material","cylinder","matCone","geoCone","userData","cone","n","rotation","PI","axisLength","orthoAxis","axisCaster","lastAxis","params","Line","threshold","lastMouse","what","delta","setAxisColor","children","ev","setPickPosition","setFromCamera","hits","intersectObjects","parent","lastCtrlPoints","Set","clearSelected","forEach","m","mat","Color","reflectivity","clear","ctrlKey","moveRaycaster","MakeCtrlPoint","dims","gap","max","min","arr","i","j","k","UpdateCtrlPoints","remove","Box3","setFromObject","Check","a","b","v","xyz","dot","productRange","prd","C","ffdOnce","l","s","t","u","P","pow","X","coeff","ffd","stu","buf","Float32Array","attributes","r","needsUpdate","size","axis_proj","project","move","dst","fi","orginalBounding","ComputeSTUOnce","res","ComputeSTUOnceObj","push","array","loader","GLTFLoader","lastHepler","loadModel","path","scale","load","traverse","Mesh","BufferGeometry","helper","changeScene","metalness","roughness","mesh","updateCtrlDims","updateScene","RunAll","ctrlPointsDims","PrettoSlider","withStyles","root","thumb","backgroundColor","border","marginTop","marginLeft","boxShadow","active","valueLabel","track","borderRadius","rail","Slider","useStyles","makeStyles","theme","flexGrow","Right","maxHeight","overflowY","paddingLeft","paddingTop","spacing","slider","display","sliderGroup","FixedMaxWidth","thediv","useRef","wrap","current","style","ref","className","id","PersonalPage","href","src","alt","Labels","Selects","App","classes","setCtrlPointsDims","setScene","Grid","container","item","xs","FormControl","variant","fullWidth","InputLabel","htmlFor","Select","value","onChange","inputProps","map","idx","MenuItem","textAlign","Typography","valueLabelDisplay","onChangeCommitted","val","Number","defaultValue","Boolean","location","hostname","match","ReactDOM","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.14464266.chunk.js","sourcesContent":["// import * as THREE from 'three'\r\n\r\n// import { MapColorToDiscrete, BeginingPrime, Integration, ComputeTransformMatrix } from './utils'\r\n\r\n\r\nexport class CanvasManager {\r\n    canvas = null\r\n    w = 0\r\n    h = 0\r\n    pickPosition = {\r\n        x: 0,\r\n        y: 0\r\n    }\r\n    frame = null\r\n\r\n    constructor(frame, canvas, render, onresize) {\r\n        this.clearPickPosition()\r\n        this.canvas = canvas\r\n        this.w = frame.clientWidth\r\n        this.h = frame.clientHeight\r\n        frame.appendChild(canvas)\r\n        frame.mouseout = ()=> this.clearPickPosition()\r\n        this.frame = frame\r\n        window.addEventListener('resize', (e)=>{\r\n            this.w = this.frame.clientWidth\r\n            this.h = this.frame.clientHeight\r\n            // render.setSize(this.w, this.h)\r\n            onresize(this.w, this.h)\r\n        })\r\n    }\r\n    \r\n    set onmousemove(fn) {\r\n        this.frame.onmousemove = fn\r\n    }\r\n\r\n    set onmousedown(fn) {\r\n        this.frame.onmousedown = fn\r\n    }\r\n\r\n    set onmouseup(fn) {\r\n        this.frame.onmouseup = fn\r\n    }\r\n\r\n    set onclick(fn) {\r\n        this.frame.onclick = fn\r\n    }\r\n\r\n    Aspect() {\r\n        return this.w / this.h\r\n    }\r\n\r\n    getCanvasRelativePosition(event) {\r\n        const rect = this.canvas.getBoundingClientRect();\r\n        return {\r\n          x: event.clientX - rect.left,\r\n          y: event.clientY - rect.top,\r\n        };\r\n    }\r\n\r\n    setPickPosition(event) {\r\n        let pickPosition = this.pickPosition\r\n        const pos = this.getCanvasRelativePosition(event);\r\n        pickPosition.x = (pos.x / this.w) *  2 - 1;\r\n        pickPosition.y = (pos.y / this.h) * -2 + 1;  // note we flip Y\r\n    }\r\n\r\n    clearPickPosition() {\r\n        let pickPosition = this.pickPosition\r\n        pickPosition.x = -100000;\r\n        pickPosition.y = -100000;\r\n    }\r\n}","/**\r\n * @author Eberhard Graether / http://egraether.com/\r\n * @author Mark Lundin \t/ http://mark-lundin.com\r\n * @author Simone Manini / http://daron1337.github.io\r\n * @author Luca Antiga \t/ http://lantiga.github.io\r\n */\r\n\r\nimport {\r\n\tEventDispatcher,\r\n\tMOUSE,\r\n\tQuaternion,\r\n\tVector2,\r\n\tVector3\r\n} from \"three\";\r\n\r\nvar TrackballControls = function ( object, domElement ) {\r\n\r\n\tvar _this = this;\r\n\tvar STATE = { NONE: - 1, ROTATE: 0, ZOOM: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_ZOOM_PAN: 4 };\r\n\r\n\tthis.object = object;\r\n\tthis.domElement = ( domElement !== undefined ) ? domElement : document;\r\n\r\n\t// API\r\n\r\n\tthis.enabled = true;\r\n\r\n\tthis.screen = { left: 0, top: 0, width: 0, height: 0 };\r\n\r\n\tthis.rotateSpeed = 1.0;\r\n\tthis.zoomSpeed = 1.2;\r\n\tthis.panSpeed = 0.3;\r\n\r\n\tthis.noRotate = false;\r\n\tthis.noZoom = false;\r\n\tthis.noPan = false;\r\n\r\n\tthis.staticMoving = false;\r\n\tthis.dynamicDampingFactor = 0.2;\r\n\r\n\tthis.minDistance = 0;\r\n\tthis.maxDistance = Infinity;\r\n\r\n\tthis.keys = [ 65 /*A*/, 83 /*S*/, 68 /*D*/ ];\r\n\r\n\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.ZOOM, RIGHT: MOUSE.PAN };\r\n\r\n\t// internals\r\n\r\n\tthis.target = new Vector3();\r\n\r\n\tvar EPS = 0.000001;\r\n\r\n\tvar lastPosition = new Vector3();\r\n\tvar lastZoom = 1;\r\n\r\n\tvar _state = STATE.NONE,\r\n\t\t_keyState = STATE.NONE,\r\n\r\n\t\t_eye = new Vector3(),\r\n\r\n\t\t_movePrev = new Vector2(),\r\n\t\t_moveCurr = new Vector2(),\r\n\r\n\t\t_lastAxis = new Vector3(),\r\n\t\t_lastAngle = 0,\r\n\r\n\t\t_zoomStart = new Vector2(),\r\n\t\t_zoomEnd = new Vector2(),\r\n\r\n\t\t_touchZoomDistanceStart = 0,\r\n\t\t_touchZoomDistanceEnd = 0,\r\n\r\n\t\t_panStart = new Vector2(),\r\n\t\t_panEnd = new Vector2();\r\n\r\n\t// for reset\r\n\r\n\tthis.target0 = this.target.clone();\r\n\tthis.position0 = this.object.position.clone();\r\n\tthis.up0 = this.object.up.clone();\r\n\tthis.zoom0 = this.object.zoom;\r\n\r\n\t// events\r\n\r\n\tvar changeEvent = { type: 'change' };\r\n\tvar startEvent = { type: 'start' };\r\n\tvar endEvent = { type: 'end' };\r\n\r\n\r\n\t// methods\r\n\r\n\tthis.handleResize = function () {\r\n\r\n\t\tif ( this.domElement === document ) {\r\n\r\n\t\t\tthis.screen.left = 0;\r\n\t\t\tthis.screen.top = 0;\r\n\t\t\tthis.screen.width = window.innerWidth;\r\n\t\t\tthis.screen.height = window.innerHeight;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar box = this.domElement.getBoundingClientRect();\r\n\t\t\t// adjustments come from similar code in the jquery offset() function\r\n\t\t\tvar d = this.domElement.ownerDocument.documentElement;\r\n\t\t\tthis.screen.left = box.left + window.pageXOffset - d.clientLeft;\r\n\t\t\tthis.screen.top = box.top + window.pageYOffset - d.clientTop;\r\n\t\t\tthis.screen.width = box.width;\r\n\t\t\tthis.screen.height = box.height;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tvar getMouseOnScreen = ( function () {\r\n\r\n\t\tvar vector = new Vector2();\r\n\r\n\t\treturn function getMouseOnScreen( pageX, pageY ) {\r\n\r\n\t\t\tvector.set(\r\n\t\t\t\t( pageX - _this.screen.left ) / _this.screen.width,\r\n\t\t\t\t( pageY - _this.screen.top ) / _this.screen.height\r\n\t\t\t);\r\n\r\n\t\t\treturn vector;\r\n\r\n\t\t};\r\n\r\n\t}() );\r\n\r\n\tvar getMouseOnCircle = ( function () {\r\n\r\n\t\tvar vector = new Vector2();\r\n\r\n\t\treturn function getMouseOnCircle( pageX, pageY ) {\r\n\r\n\t\t\tvector.set(\r\n\t\t\t\t( ( pageX - _this.screen.width * 0.5 - _this.screen.left ) / ( _this.screen.width * 0.5 ) ),\r\n\t\t\t\t( ( _this.screen.height + 2 * ( _this.screen.top - pageY ) ) / _this.screen.width ) // screen.width intentional\r\n\t\t\t);\r\n\r\n\t\t\treturn vector;\r\n\r\n\t\t};\r\n\r\n\t}() );\r\n\r\n\tthis.rotateCamera = ( function () {\r\n\r\n\t\tvar axis = new Vector3(),\r\n\t\t\tquaternion = new Quaternion(),\r\n\t\t\teyeDirection = new Vector3(),\r\n\t\t\tobjectUpDirection = new Vector3(),\r\n\t\t\tobjectSidewaysDirection = new Vector3(),\r\n\t\t\tmoveDirection = new Vector3(),\r\n\t\t\tangle;\r\n\r\n\t\treturn function rotateCamera() {\r\n\r\n\t\t\tmoveDirection.set( _moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0 );\r\n\t\t\tangle = moveDirection.length();\r\n\r\n\t\t\tif ( angle ) {\r\n\r\n\t\t\t\t_eye.copy( _this.object.position ).sub( _this.target );\r\n\r\n\t\t\t\teyeDirection.copy( _eye ).normalize();\r\n\t\t\t\tobjectUpDirection.copy( _this.object.up ).normalize();\r\n\t\t\t\tobjectSidewaysDirection.crossVectors( objectUpDirection, eyeDirection ).normalize();\r\n\r\n\t\t\t\tobjectUpDirection.setLength( _moveCurr.y - _movePrev.y );\r\n\t\t\t\tobjectSidewaysDirection.setLength( _moveCurr.x - _movePrev.x );\r\n\r\n\t\t\t\tmoveDirection.copy( objectUpDirection.add( objectSidewaysDirection ) );\r\n\r\n\t\t\t\taxis.crossVectors( moveDirection, _eye ).normalize();\r\n\r\n\t\t\t\tangle *= _this.rotateSpeed;\r\n\t\t\t\tquaternion.setFromAxisAngle( axis, angle );\r\n\r\n\t\t\t\t_eye.applyQuaternion( quaternion );\r\n\t\t\t\t_this.object.up.applyQuaternion( quaternion );\r\n\r\n\t\t\t\t_lastAxis.copy( axis );\r\n\t\t\t\t_lastAngle = angle;\r\n\r\n\t\t\t} else if ( ! _this.staticMoving && _lastAngle ) {\r\n\r\n\t\t\t\t_lastAngle *= Math.sqrt( 1.0 - _this.dynamicDampingFactor );\r\n\t\t\t\t_eye.copy( _this.object.position ).sub( _this.target );\r\n\t\t\t\tquaternion.setFromAxisAngle( _lastAxis, _lastAngle );\r\n\t\t\t\t_eye.applyQuaternion( quaternion );\r\n\t\t\t\t_this.object.up.applyQuaternion( quaternion );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_movePrev.copy( _moveCurr );\r\n\r\n\t\t};\r\n\r\n\t}() );\r\n\r\n\r\n\tthis.zoomCamera = function () {\r\n\r\n\t\tvar factor;\r\n\r\n\t\tif ( _state === STATE.TOUCH_ZOOM_PAN ) {\r\n\r\n\t\t\tfactor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\r\n\t\t\t_touchZoomDistanceStart = _touchZoomDistanceEnd;\r\n\r\n\t\t\tif ( _this.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t\t_eye.multiplyScalar( factor );\r\n\r\n\t\t\t} else if ( _this.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\t_this.object.zoom *= factor;\r\n\t\t\t\t_this.object.updateProjectionMatrix();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfactor = 1.0 + ( _zoomEnd.y - _zoomStart.y ) * _this.zoomSpeed;\r\n\r\n\t\t\tif ( factor !== 1.0 && factor > 0.0 ) {\r\n\r\n\t\t\t\tif ( _this.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t\t\t_eye.multiplyScalar( factor );\r\n\r\n\t\t\t\t} else if ( _this.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\t\t_this.object.zoom /= factor;\r\n\t\t\t\t\t_this.object.updateProjectionMatrix();\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( _this.staticMoving ) {\r\n\r\n\t\t\t\t_zoomStart.copy( _zoomEnd );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_zoomStart.y += ( _zoomEnd.y - _zoomStart.y ) * this.dynamicDampingFactor;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.panCamera = ( function () {\r\n\r\n\t\tvar mouseChange = new Vector2(),\r\n\t\t\tobjectUp = new Vector3(),\r\n\t\t\tpan = new Vector3();\r\n\r\n\t\treturn function panCamera() {\r\n\r\n\t\t\tmouseChange.copy( _panEnd ).sub( _panStart );\r\n\r\n\t\t\tif ( mouseChange.lengthSq() ) {\r\n\r\n\t\t\t\tif ( _this.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\t\tvar scale_x = ( _this.object.right - _this.object.left ) / _this.object.zoom / _this.domElement.clientWidth;\r\n\t\t\t\t\tvar scale_y = ( _this.object.top - _this.object.bottom ) / _this.object.zoom / _this.domElement.clientWidth;\r\n\r\n\t\t\t\t\tmouseChange.x *= scale_x;\r\n\t\t\t\t\tmouseChange.y *= scale_y;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmouseChange.multiplyScalar( _eye.length() * _this.panSpeed );\r\n\r\n\t\t\t\tpan.copy( _eye ).cross( _this.object.up ).setLength( mouseChange.x );\r\n\t\t\t\tpan.add( objectUp.copy( _this.object.up ).setLength( mouseChange.y ) );\r\n\r\n\t\t\t\t_this.object.position.add( pan );\r\n\t\t\t\t_this.target.add( pan );\r\n\r\n\t\t\t\tif ( _this.staticMoving ) {\r\n\r\n\t\t\t\t\t_panStart.copy( _panEnd );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t_panStart.add( mouseChange.subVectors( _panEnd, _panStart ).multiplyScalar( _this.dynamicDampingFactor ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}() );\r\n\r\n\tthis.checkDistances = function () {\r\n\r\n\t\tif ( ! _this.noZoom || ! _this.noPan ) {\r\n\r\n\t\t\tif ( _eye.lengthSq() > _this.maxDistance * _this.maxDistance ) {\r\n\r\n\t\t\t\t_this.object.position.addVectors( _this.target, _eye.setLength( _this.maxDistance ) );\r\n\t\t\t\t_zoomStart.copy( _zoomEnd );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( _eye.lengthSq() < _this.minDistance * _this.minDistance ) {\r\n\r\n\t\t\t\t_this.object.position.addVectors( _this.target, _eye.setLength( _this.minDistance ) );\r\n\t\t\t\t_zoomStart.copy( _zoomEnd );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.update = function () {\r\n\r\n\t\t_eye.subVectors( _this.object.position, _this.target );\r\n\r\n\t\tif ( ! _this.noRotate ) {\r\n\r\n\t\t\t_this.rotateCamera();\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! _this.noZoom ) {\r\n\r\n\t\t\t_this.zoomCamera();\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! _this.noPan ) {\r\n\r\n\t\t\t_this.panCamera();\r\n\r\n\t\t}\r\n\r\n\t\t_this.object.position.addVectors( _this.target, _eye );\r\n\r\n\t\tif ( _this.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t_this.checkDistances();\r\n\r\n\t\t\t_this.object.lookAt( _this.target );\r\n\r\n\t\t\tif ( lastPosition.distanceToSquared( _this.object.position ) > EPS ) {\r\n\r\n\t\t\t\t_this.dispatchEvent( changeEvent );\r\n\r\n\t\t\t\tlastPosition.copy( _this.object.position );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( _this.object.isOrthographicCamera ) {\r\n\r\n\t\t\t_this.object.lookAt( _this.target );\r\n\r\n\t\t\tif ( lastPosition.distanceToSquared( _this.object.position ) > EPS ||Â lastZoom !== _this.object.zoom ) {\r\n\r\n\t\t\t\t_this.dispatchEvent( changeEvent );\r\n\r\n\t\t\t\tlastPosition.copy( _this.object.position );\r\n\t\t\t\tlastZoom = _this.object.zoom;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.reset = function () {\r\n\r\n\t\t_state = STATE.NONE;\r\n\t\t_keyState = STATE.NONE;\r\n\r\n\t\t_this.target.copy( _this.target0 );\r\n\t\t_this.object.position.copy( _this.position0 );\r\n\t\t_this.object.up.copy( _this.up0 );\r\n\t\t_this.object.zoom = _this.zoom0;\r\n\r\n\t\t_this.object.updateProjectionMatrix();\r\n\r\n\t\t_eye.subVectors( _this.object.position, _this.target );\r\n\r\n\t\t_this.object.lookAt( _this.target );\r\n\r\n\t\t_this.dispatchEvent( changeEvent );\r\n\r\n\t\tlastPosition.copy( _this.object.position );\r\n\t\tlastZoom = _this.object.zoom;\r\n\r\n\t};\r\n\r\n\t// listeners\r\n\r\n\tfunction mousedown( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tif ( _state === STATE.NONE ) {\r\n\r\n\t\t\tswitch ( event.button ) {\r\n\r\n\t\t\t\tcase _this.mouseButtons.LEFT:\r\n\t\t\t\t\t_state = STATE.ROTATE;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase _this.mouseButtons.MIDDLE:\r\n\t\t\t\t\t_state = STATE.ZOOM;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase _this.mouseButtons.RIGHT:\r\n\t\t\t\t\t_state = STATE.PAN;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t_state = STATE.NONE;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\r\n\r\n\t\tif ( state === STATE.ROTATE && ! _this.noRotate ) {\r\n\r\n\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\r\n\t\t\t_movePrev.copy( _moveCurr );\r\n\r\n\t\t} else if ( state === STATE.ZOOM && ! _this.noZoom ) {\r\n\r\n\t\t\t_zoomStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\r\n\t\t\t_zoomEnd.copy( _zoomStart );\r\n\r\n\t\t} else if ( state === STATE.PAN && ! _this.noPan ) {\r\n\r\n\t\t\t_panStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\r\n\t\t\t_panEnd.copy( _panStart );\r\n\r\n\t\t}\r\n\r\n\t\tdocument.addEventListener( 'mousemove', mousemove, false );\r\n\t\tdocument.addEventListener( 'mouseup', mouseup, false );\r\n\r\n\t\t_this.dispatchEvent( startEvent );\r\n\r\n\t}\r\n\r\n\tfunction mousemove( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tvar state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\r\n\r\n\t\tif ( state === STATE.ROTATE && ! _this.noRotate ) {\r\n\r\n\t\t\t_movePrev.copy( _moveCurr );\r\n\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\r\n\r\n\t\t} else if ( state === STATE.ZOOM && ! _this.noZoom ) {\r\n\r\n\t\t\t_zoomEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\r\n\r\n\t\t} else if ( state === STATE.PAN && ! _this.noPan ) {\r\n\r\n\t\t\t_panEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction mouseup( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\t_state = STATE.NONE;\r\n\r\n\t\tdocument.removeEventListener( 'mousemove', mousemove );\r\n\t\tdocument.removeEventListener( 'mouseup', mouseup );\r\n\t\t_this.dispatchEvent( endEvent );\r\n\r\n\t}\r\n\r\n\tfunction mousewheel( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tif ( _this.noZoom === true ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tswitch ( event.deltaMode ) {\r\n\r\n\t\t\tcase 2:\r\n\t\t\t\t// Zoom in pages\r\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.025;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\t// Zoom in lines\r\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.01;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\t// undefined, 0, assume pixels\r\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.00025;\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\t_this.dispatchEvent( startEvent );\r\n\t\t_this.dispatchEvent( endEvent );\r\n\r\n\t}\r\n\r\n\tfunction touchstart( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tswitch ( event.touches.length ) {\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\r\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\r\n\t\t\t\t_movePrev.copy( _moveCurr );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault: // 2 or more\r\n\t\t\t\t_state = STATE.TOUCH_ZOOM_PAN;\r\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\r\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\r\n\t\t\t\t_touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\r\n\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\r\n\t\t\t\t_panStart.copy( getMouseOnScreen( x, y ) );\r\n\t\t\t\t_panEnd.copy( _panStart );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\t_this.dispatchEvent( startEvent );\r\n\r\n\t}\r\n\r\n\tfunction touchmove( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tswitch ( event.touches.length ) {\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\t_movePrev.copy( _moveCurr );\r\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault: // 2 or more\r\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\r\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\r\n\t\t\t\t_touchZoomDistanceEnd = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\r\n\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\r\n\t\t\t\t_panEnd.copy( getMouseOnScreen( x, y ) );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction touchend( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tswitch ( event.touches.length ) {\r\n\r\n\t\t\tcase 0:\r\n\t\t\t\t_state = STATE.NONE;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\r\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\r\n\t\t\t\t_movePrev.copy( _moveCurr );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\t_this.dispatchEvent( endEvent );\r\n\r\n\t}\r\n\r\n\tfunction contextmenu( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t}\r\n\r\n\tthis.dispose = function () {\r\n\r\n\t\tthis.domElement.removeEventListener( 'contextmenu', contextmenu, false );\r\n\t\tthis.domElement.removeEventListener( 'mousedown', mousedown, false );\r\n\t\tthis.domElement.removeEventListener( 'wheel', mousewheel, false );\r\n\r\n\t\tthis.domElement.removeEventListener( 'touchstart', touchstart, false );\r\n\t\tthis.domElement.removeEventListener( 'touchend', touchend, false );\r\n\t\tthis.domElement.removeEventListener( 'touchmove', touchmove, false );\r\n\r\n\t\tdocument.removeEventListener( 'mousemove', mousemove, false );\r\n\t\tdocument.removeEventListener( 'mouseup', mouseup, false );\r\n\r\n\t\t// window.removeEventListener( 'keydown', keydown, false );\r\n\t\t// window.removeEventListener( 'keyup', keyup, false );\r\n\r\n\t};\r\n\r\n\r\n\tthis.attachCallback = function () {\r\n\t\tthis.domElement.addEventListener( 'contextmenu', contextmenu, false );\r\n\t\tthis.domElement.addEventListener( 'mousedown', mousedown, false );\r\n\t\tthis.domElement.addEventListener( 'wheel', mousewheel, false );\r\n\r\n\t\tthis.domElement.addEventListener( 'touchstart', touchstart, false );\r\n\t\tthis.domElement.addEventListener( 'touchend', touchend, false );\r\n\t\tthis.domElement.addEventListener( 'touchmove', touchmove, false );\r\n\t}\r\n\r\n\tthis.attachCallback()\r\n\t//this.domElement.addEventListener( 'contextmenu', contextmenu, false );\r\n\t//this.domElement.addEventListener( 'mousedown', mousedown, false );\r\n\t//this.domElement.addEventListener( 'wheel', mousewheel, false );\r\n\r\n\t//this.domElement.addEventListener( 'touchstart', touchstart, false );\r\n\t//this.domElement.addEventListener( 'touchend', touchend, false );\r\n\t//this.domElement.addEventListener( 'touchmove', touchmove, false );\r\n\r\n\t// window.addEventListener( 'keydown', keydown, false );\r\n\t// window.addEventListener( 'keyup', keyup, false );\r\n\r\n\tthis.handleResize();\r\n\r\n\t// force an update at start\r\n\tthis.update();\r\n\r\n};\r\n\r\nTrackballControls.prototype = Object.create( EventDispatcher.prototype );\r\nTrackballControls.prototype.constructor = TrackballControls;\r\n\r\nexport { TrackballControls };\r\n","import React, { useEffect, useState } from 'react'\r\nimport { CanvasManager } from './canvas'\r\nimport * as THREE from 'three'\r\nimport { TrackballControls } from './traceballctrl'\r\n//import { TrackballControls } from 'three/examples/jsm/controls/TrackballControls'\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport { Box3, Group, Mesh, BufferGeometry, BufferAttribute, MeshBasicMaterial, Color } from 'three'\r\n// import { DragControls } from 'three/examples/jsm/controls/DragControls'\r\n\r\ninterface RenderProps {\r\n    ctrlPointsDims: [number, number, number]\r\n    scene:string\r\n}\r\n\r\ninterface STU {\r\n    object: Mesh\r\n    stu: Float32Array\r\n}\r\n\r\nconst Render : React.FC<RenderProps> = (props)=>{\r\n    const [handle, setHandle] = useState<ReturnType<typeof RunAll>>()\r\n    useEffect(()=>{\r\n        setHandle(RunAll())\r\n    }, [])\r\n\r\n    // eslint-disable: react-hooks/exhaustive-deps\r\n    useEffect(()=>{\r\n        if(handle){\r\n            const dims = props.ctrlPointsDims\r\n            handle.updateCtrlDims(...dims)\r\n        }\r\n    }, [props.ctrlPointsDims])\r\n\r\n    // eslint-disable-next-line\r\n    useEffect(()=>{\r\n        if(handle) {\r\n            handle.updateScene(props.scene)\r\n        }\r\n    }, [props.scene])\r\n\r\n    return (null)\r\n}\r\n\r\nexport default Render;\r\n\r\n\r\n\r\nfunction RunAll () {\r\nconst HandleResize = ()=>{Resize()}\r\nconst frame = document.getElementById('canvas-frame'); if(frame === null) return;\r\nconst scene = new THREE.Scene();\r\nconst renderer = new THREE.WebGLRenderer({antialias : true, powerPreference:'high-performance'});\r\nconst canvas = new CanvasManager(frame, renderer.domElement, renderer, HandleResize);\r\nconst camera = new THREE.PerspectiveCamera(75, canvas.Aspect(), 0.1, 1000);\r\nconst flatScene = new THREE.Scene()\r\nconst flatCamera = new THREE.PerspectiveCamera(75, canvas.Aspect(), 0.1, 1000);\r\nlet currentScale = 0.1\r\n\r\nrenderer.setSize(canvas.w, canvas.h);\r\nrenderer.setClearColor(0x444444, 1.0);\r\n\r\ncamera.position.z = 5;\r\nflatCamera.position.z = 5\r\nvar Resize=() => {\r\n    console.log(canvas.w, canvas.h)\r\n    // camera.aspect = canvas.Aspect()\r\n    // camera.updateMatrix()\r\n}\r\nconst control = new TrackballControls(camera, frame)\r\n// const fpControl = new KeyControls(camera, frame)\r\ncontrol.target.set(0, 0, 0)\r\ncontrol.rotateSpeed = 8.0;\r\ncontrol.noPan = false\r\ncontrol.maxDistance = 60\r\ncontrol.keys = []\r\ncontrol.dispose()\r\nconst ambientLight = new THREE.AmbientLight( 0x404040 ); // soft white light\r\nscene.add( ambientLight );\r\nvar light = new THREE.PointLight( 0xffffff, 1, 100 );\r\nlight.position.set( 10, 10, 10 );\r\nscene.add( light );\r\n\r\nvar plight = new THREE.PointLight( 0xffffff, 1, 200 );\r\nplight.position.set( -40, 20, 20 );\r\nscene.add( plight );\r\n\r\nvar light1 = new THREE.PointLight( 0xffffff, 1, 200 );\r\nlight1.position.set( -40, -20, -20 );\r\nscene.add( light1 );\r\n\r\nvar light2 = new THREE.PointLight( 0xffffff, 1, 200 );\r\nlight2.position.set( -20, 10, -10 );\r\nscene.add( light2 );\r\n\r\nlet ctrlPoints = new Array<Array<Array<THREE.Vector3>>>()\r\nlet objectScene : THREE.Scene | THREE.Object3D | null = null\r\nlet ctrlPointsGroup = new Group()\r\nlet STUs = new Array<STU>()\r\nlet dimensions = new THREE.Vector3(2, 2, 2)\r\n// let bounding = new Box3()\r\n\r\nscene.add(ctrlPointsGroup)\r\n\r\nfunction render(tm : number) {\r\n    requestAnimationFrame(render);\r\n    renderer.autoClear = true;\r\n    renderer.render(scene, camera);\r\n    renderer.autoClear = false;\r\n    renderer.render(flatScene, flatCamera)\r\n    // fpControl.update(tm - lastTm)\r\n    control.update();\r\n}\r\nrender(0);\r\n\r\nconst axies = new THREE.Group()\r\nscene.add(axies)\r\n\r\nconst MakeOne = (x: number, y: number, z: number, color: number, name ?: string)=>{\r\n    const group = new THREE.Group();\r\n    var geometry = new THREE.CylinderGeometry( 0.015, 0.015, x||y||z, 3 );\r\n    var material = new THREE.MeshBasicMaterial( {color: color} );\r\n    var cylinder = new THREE.Mesh( geometry, material );\r\n    cylinder.position.set(x/2,y/2,z/2)\r\n    \r\n    const matCone = new THREE.ConeGeometry( 0.05, 0.1, 6 );\r\n    \r\n    const geoCone = new THREE.MeshBasicMaterial( {color: color} );\r\n    cylinder.userData = { name: name, color:color, axis: new THREE.Vector3(x, y, z) }\r\n\r\n    const cone = new THREE.Mesh( matCone, geoCone );\r\n    cone.position.set(x, y, z)\r\n    const n = cone.position.clone().normalize()\r\n    cone.rotation.set(n.z * Math.PI / 2, n.y * Math.PI / 2, -n.x * Math.PI / 2)\r\n    cone.userData = { name: name, color:color, axis: new THREE.Vector3(x, y, z) }\r\n    cylinder.rotation.set(n.z * Math.PI / 2, n.y * Math.PI / 2, -n.x * Math.PI / 2)\r\n    \r\n    group.userData = { name: name, color:color, axis: new THREE.Vector3(x, y, z) }\r\n    group.add(cylinder, cone)\r\n    return group;\r\n}\r\n\r\nconst axisLength = 0.6 as const\r\n\r\n{\r\n    const group = MakeOne(axisLength, 0, 0, 0xffff00, 'x')\r\n    axies.add(group)\r\n}\r\n{\r\n    const group = MakeOne(0, axisLength, 0, 0xff00ff, 'y')\r\n    axies.add(group)\r\n}\r\n{\r\n    const group = MakeOne(0, 0, axisLength, 0x00aaff, 'z')\r\n    axies.add(group)\r\n}\r\n\r\nconst orthoAxis = new THREE.Group()\r\n\r\nflatScene.add(orthoAxis)\r\n{\r\n    const group = MakeOne(1, 0, 0, 0xffff00)\r\n    orthoAxis.add(group)\r\n}\r\n{\r\n    const group = MakeOne(0, 1, 0, 0xff00ff)\r\n    orthoAxis.add(group)\r\n}\r\n{\r\n    const group = MakeOne(0, 0, 0.5, 0x00aaff)\r\n    orthoAxis.add(group)\r\n}\r\northoAxis.position.set(-6 * canvas.Aspect(), -6 , -4.6)\r\n\r\nconst axisCaster = new THREE.Raycaster()\r\nlet lastAxis : THREE.Group | null = null\r\n// axisCaster.linePrecision = 0.05;\r\n// axisCaster.params = { Line: { threshold: 100 } }\r\naxisCaster.params.Line = { threshold:5 }\r\nlet mousedown = false\r\nlet lastMouse = {\r\n    x: 0,\r\n    y: 0,\r\n    update: (what:{x:number,y:number}) => {\r\n        let delta = new THREE.Vector3(\r\n            what.x - lastMouse.x,\r\n            what.y - lastMouse.y\r\n        )\r\n        lastMouse.x = what.x\r\n        lastMouse.y = what.y\r\n        return delta;\r\n    },\r\n    clone: () => {\r\n        return {\r\n            x: lastMouse.x,\r\n            y: lastMouse.y\r\n        }\r\n    }\r\n}\r\n\r\nconst setAxisColor = (color:number) => {\r\n    if(!lastAxis) return;\r\n    ((lastAxis.children[0] as Mesh).material as MeshBasicMaterial).color.set( color );\r\n    ((lastAxis.children[1] as Mesh).material as MeshBasicMaterial).color.set( color );\r\n}\r\n\r\n\r\n//frame.onmousedown \r\n\r\nconst onmousedown = (ev:MouseEvent)=>{\r\n    console.log('On mouse down')\r\n    mousedown = true\r\n    canvas.setPickPosition(ev)\r\n    lastMouse.update(canvas.pickPosition)\r\n    axisCaster.setFromCamera(canvas.pickPosition, camera);\r\n    const hits = axisCaster.intersectObjects(axies.children, true)\r\n    if(lastAxis !== null) {\r\n        setAxisColor( lastAxis.userData.color );\r\n        lastAxis = null\r\n    }\r\n    if(hits.length) {\r\n        control.enabled = false;\r\n        lastAxis = hits[0].object.parent as Group;\r\n        setAxisColor( 0xffffff );\r\n    }\r\n}\r\nframe.onmousedown = onmousedown\r\n\r\nlet lastCtrlPoints = new Set<Mesh>()\r\n\r\nconst clearSelected = ()=>{\r\n    lastCtrlPoints.forEach(m=>{\r\n        const mat = (m.material as THREE.MeshLambertMaterial);\r\n        // mat.emissive = new THREE.Color(0xbbbbbb);\r\n        mat.color = new Color(0x999999)\r\n        mat.reflectivity = 1\r\n    });\r\n    lastCtrlPoints.clear()\r\n}\r\n\r\n\r\nframe.onclick = (ev)=>{\r\n    canvas.setPickPosition(ev)\r\n    axisCaster.setFromCamera(canvas.pickPosition, camera);\r\n    const hits = axisCaster.intersectObjects(ctrlPointsGroup.children)\r\n    if(hits.length) {\r\n        if(!ev.ctrlKey) {\r\n            clearSelected()   \r\n        }\r\n        lastCtrlPoints.add(hits[0].object as Mesh);\r\n        const mat  = (hits[0].object as THREE.Mesh).material as THREE.MeshLambertMaterial;\r\n        // mat.emissive = new THREE.Color(0x99ffee);\r\n        mat.color = new Color(0xbb44ff)\r\n        mat.reflectivity = 1.4\r\n        const pos = hits[0].object.position\r\n        axies.position.set(pos.x, pos.y, pos.z)\r\n    }\r\n}\r\n\r\nconst moveRaycaster = new THREE.Raycaster();\r\n\r\nframe.onmousemove = (ev)=>{\r\n    if(lastAxis === null || !mousedown || !lastCtrlPoints.size) {\r\n        return\r\n    }\r\n    canvas.setPickPosition(ev)\r\n    const delta = lastMouse.update(canvas.pickPosition)\r\n    if(delta.length() === 0) return;\r\n    const axis = lastAxis.userData.axis as THREE.Vector3\r\n    const axis_proj = axis.clone().project(camera);\r\n    //const axis_proj2d = axis_proj.clone();\r\n    axis_proj.z = 0\r\n\r\n    moveRaycaster.setFromCamera(canvas.pickPosition, camera);\r\n\r\n    const raw_move = axis_proj.dot(delta) / axis_proj.length();\r\n    //const dst = axis_proj2d.multiplyScalar(raw_move).add(axis_proj);\r\n\r\n    ///axis_proj.x += axis_proj2d.x\r\n    //axis_proj.y += axis_proj2d.y\r\n    //const dst = axis_proj.unproject(camera);\r\n    //axies.position.set(dst.x, dst.y, dst.z);\r\n\r\n    const move = raw_move * (axisLength / axis_proj.length()) * 0.76;\r\n    const dst = axis.clone().multiplyScalar(move); // move direction vector\r\n    \r\n    // dst.add(axies.position)\r\n    \r\n    axies.position.add(dst);\r\n\r\n    lastCtrlPoints.forEach(m=>{\r\n        m.position.add(dst)\r\n        const fi = m.position;\r\n        const xyz = m.userData.xyz\r\n        ctrlPoints[xyz[0]][xyz[1]][xyz[2]].set(fi.x, fi.y, fi.z);\r\n    })\r\n    ffd();\r\n}\r\n\r\nframe.onmouseup = (ev)=>{\r\n    mousedown = false\r\n    control.enabled = true\r\n    if(lastAxis !== null) {\r\n        setAxisColor( lastAxis.userData.color )\r\n        \r\n        lastAxis = null\r\n    }\r\n}\r\n\r\nfunction MakeCtrlPoint(dims : THREE.Vector3, box : THREE.Box3, fn: (v:THREE.Vector3, xyz: number[])=>any) {\r\n    const gap = box.max.clone().sub(box.min)\r\n    const arr = new Array<Array<Array<THREE.Vector3>>>()\r\n    \r\n    for(let i = 0; i < dims.x + 1; ++i) {\r\n        arr[i] = new Array<Array<THREE.Vector3>>()\r\n        for(let j = 0; j < dims.y + 1; ++j) {\r\n            arr[i][j] = new Array<THREE.Vector3>()\r\n            for(let k = 0; k < dims.z + 1; ++k) {\r\n                arr[i][j][k] = new THREE.Vector3(\r\n                    gap.x / dims.x * i,\r\n                    gap.y / dims.y * j,\r\n                    gap.z / dims.z * k,\r\n                )\r\n                arr[i][j][k].add(box.min)\r\n                fn(arr[i][j][k], [i, j, k])\r\n            }\r\n        }\r\n    }\r\n    return arr\r\n}\r\n\r\n\r\n// children[0]: lines\r\n// children[1]: plane\r\n// const lattices = new THREE.Group();\r\n\r\nfunction UpdateCtrlPoints(dims : THREE.Vector3) {\r\n    if(objectScene === null) {\r\n        return\r\n    }\r\n\r\n    dimensions = dims\r\n    while (ctrlPointsGroup.children.length)\r\n    {\r\n        ctrlPointsGroup.remove(ctrlPointsGroup.children[0]);\r\n    }\r\n\r\n    let box = new Box3().setFromObject(objectScene);\r\n    console.log(box)\r\n    // bounding = box\r\n    const Check = (a : number, b : number)=>{\r\n        return a === 0 || a === b\r\n    }\r\n    ctrlPoints = MakeCtrlPoint(dims, box, (v, xyz)=>{\r\n        if(!(Check(xyz[0], dims.x) || Check(xyz[1], dims.y) || Check(xyz[2], dims.z))) return;\r\n        let geometry = new THREE.SphereGeometry(0.042, 16, 16)\r\n        let material = new THREE.MeshLambertMaterial({color:0xaaaaaa});\r\n        let dot = new THREE.Mesh(geometry, material)\r\n        dot.position.set(v.x, v.y, v.z)\r\n        dot.userData = { xyz: xyz }\r\n        ctrlPointsGroup.add(dot)\r\n    })\r\n}\r\n\r\nfunction productRange(a:number, b:number) {\r\n    let prd = a, i = a;\r\n    while(i++ < b) {\r\n        prd *= i\r\n    }\r\n    return prd\r\n}\r\n\r\nfunction C(n:number, k:number) {\r\n    k = (k < n-k) ? n-k : k // this must go first\r\n    if(n === k) return 1;\r\n    return productRange(k+1, n) / productRange(1, n-k)\r\n}\r\n\r\nfunction ffdOnce(l:number, m:number, n:number, s:number, t:number, u:number, P:THREE.Vector3[][][] /*ctrl point*/) {\r\n    const pow = Math.pow\r\n    const X = new THREE.Vector3(0,0,0)\r\n    for(let i = 0; i <= l; ++i) {\r\n        for(let j = 0; j <= m; ++j) {\r\n            for(let k = 0; k <= n; ++k) {\r\n                const coeff = \r\n                    C(l,i)*pow(1-s,l-i)*pow(s,i)* // bernstein\r\n                    C(m,j)*pow(1-t,m-j)*pow(t,j)*\r\n                    C(n,k)*pow(1-u,n-k)*pow(u,k)\r\n                X.add(P[i][j][k].clone().multiplyScalar(coeff))\r\n            }\r\n        }\r\n    }\r\n    X.multiplyScalar(1/currentScale)\r\n    return X\r\n}\r\n\r\nfunction ffd() {\r\n    for(let stu of STUs) {\r\n        let v = stu.stu\r\n        let buf = new Float32Array(v.length);\r\n        let pos = (stu.object.geometry as BufferGeometry).attributes.position as BufferAttribute;\r\n        \r\n        for(let i = 0; i < v.length; i+=3){\r\n            let r = ffdOnce(dimensions.x, dimensions.y, dimensions.z, v[i], v[i+1], v[i+2], ctrlPoints);\r\n            buf[i]   = r.x\r\n            buf[i+1] = r.y\r\n            buf[i+2] = r.z\r\n        }\r\n        pos.set(buf)\r\n        pos.needsUpdate = true\r\n    }\r\n}\r\n\r\nlet orginalBounding = new THREE.Box3()\r\n\r\nfunction ComputeSTUOnce(v : ArrayLike<number>, box:Box3) {\r\n    const res = new Float32Array(v.length)\r\n    const gap = box.max.clone().sub(box.min)\r\n    for(let i = 0; i < v.length;++i){\r\n        res[i] = (v[i] - box.min.x) / gap.x\r\n        ++i;\r\n        res[i] = (v[i] - box.min.y) / gap.y\r\n        ++i;\r\n        res[i] = (v[i] - box.min.z) / gap.z\r\n    }\r\n    return res\r\n}\r\n\r\nfunction ComputeSTUOnceObj(object:Mesh) {\r\n    STUs.push(\r\n        {\r\n            object: object,\r\n            stu: ComputeSTUOnce(((object.geometry as BufferGeometry).attributes.position as BufferAttribute).array, orginalBounding)\r\n        }\r\n    )\r\n}\r\n\r\nconst loader = new GLTFLoader()\r\nlet lastHepler: THREE.BoxHelper | null = null\r\nconst loadModel = (path:string, scale: number)=>{\r\n    loader.load(path, (m)=>{\r\n        if(objectScene) {\r\n            scene.remove(objectScene);\r\n        }\r\n        currentScale = scale\r\n        orginalBounding.setFromObject(m.scene)\r\n        m.scene.scale.set(scale, scale, scale)\r\n        scene.add(m.scene)\r\n        objectScene = m.scene\r\n        STUs = []\r\n        \r\n        m.scene.traverse(object=>{\r\n            if(object instanceof Mesh) {\r\n                if(object.geometry instanceof BufferGeometry) {\r\n                    ComputeSTUOnceObj(object);\r\n                }\r\n            }\r\n        })\r\n        if(lastHepler) scene.remove(lastHepler)\r\n\r\n        let helper = new THREE.BoxHelper(m.scene, new THREE.Color(0xaa3348));\r\n        helper.update();\r\n        scene.add(helper); \r\n        lastHepler = helper\r\n        UpdateCtrlPoints(dimensions)\r\n    })\r\n}\r\n\r\nconst changeScene = (what:string)=>{\r\n    if(what === 'book') {\r\n        loadModel('./book/scene.gltf', 0.1)\r\n    }\r\n    else if(what === 'car') {\r\n        loadModel('./car/scene.gltf', 0.003);\r\n    }\r\n    else {\r\n        if(lastHepler) scene.remove(lastHepler)\r\n        if(objectScene) scene.remove(objectScene);\r\n        const material = new THREE.MeshPhysicalMaterial( {color: 0x2194ce, metalness: 0.5, roughness: 0.6 } );\r\n        let geometry: THREE.BufferGeometry | null = null\r\n        if(what === 'sphere') {\r\n            geometry = new THREE.SphereBufferGeometry( 0.5, 64, 64 );\r\n        }\r\n        else if (what === 'cube') {\r\n            geometry = new THREE.BoxBufferGeometry(1, 1, 1, 8, 8, 8);\r\n        }\r\n        else if(what === 'cylinder') {\r\n            geometry = new THREE.CylinderBufferGeometry( 0.5, 0.5, 1, 32 );\r\n        }\r\n        else if(what === 'donut') {\r\n            geometry = new THREE.TorusBufferGeometry( 0.5, 0.25, 16, 100 );\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n        const mesh = new THREE.Mesh( geometry, material );\r\n        orginalBounding.setFromObject(mesh);\r\n        objectScene = mesh\r\n        UpdateCtrlPoints(dimensions)\r\n        STUs=[]\r\n        ComputeSTUOnceObj(mesh)\r\n        currentScale = 1\r\n        scene.add( mesh );\r\n    }\r\n    \r\n}\r\n\r\nchangeScene('book')\r\ncontrol.attachCallback()\r\n\r\nreturn {\r\n    updateCtrlDims: (x:number, y:number, z:number)=> UpdateCtrlPoints(new THREE.Vector3(x, y, z)),\r\n    updateScene: (x:string)=>changeScene(x),\r\n    reset: ()=>{ UpdateCtrlPoints(dimensions); ffd(); }\r\n}\r\n\r\n}","\r\nimport React, { useRef, useEffect } from 'react';\r\nimport Slider from '@material-ui/core/Slider';\r\nimport { withStyles, makeStyles } from '@material-ui/core/styles';\r\n\r\nexport const PrettoSlider = withStyles({\r\n    root: {\r\n      color: '#52af77',\r\n      height: 8,\r\n    },\r\n    thumb: {\r\n      height: 24,\r\n      width: 24,\r\n      backgroundColor: '#fff',\r\n      border: '2px solid currentColor',\r\n      marginTop: -8,\r\n      marginLeft: -12,\r\n      '&:focus,&:hover,&$active': {\r\n        boxShadow: 'inherit',\r\n      },\r\n    },\r\n    active: {},\r\n    valueLabel: {\r\n      left: 'calc(-50% + 4px)',\r\n    },\r\n    track: {\r\n      height: 8,\r\n      borderRadius: 4,\r\n    },\r\n    rail: {\r\n      height: 8,\r\n      borderRadius: 4,\r\n    },\r\n  })(Slider);\r\n\r\n\r\nexport const useStyles = makeStyles(theme => ({\r\n    root: {\r\n      flexGrow: 1,\r\n    },\r\n    Right: {\r\n        maxHeight: '100vh',\r\n        overflowY: 'scroll',\r\n        paddingLeft: 20,\r\n        paddingTop: theme.spacing(2)\r\n    },\r\n    slider: {\r\n        display: 'inline'\r\n    },\r\n    sliderGroup:{\r\n      marginTop: theme.spacing(3)\r\n    }\r\n}))\r\n\r\nconst FixedMaxWidth:React.FC =  (props)=>{\r\n    const thediv = useRef<HTMLDivElement>(null)\r\n    const wrap = useRef<HTMLDivElement>(null)\r\n    useEffect(()=>{\r\n        if(thediv.current && wrap.current) {\r\n            thediv.current.style.width = wrap.current.style.width\r\n        }\r\n      \r\n    }, [])\r\n    return(\r\n      <div ref={wrap} className='canvas-frame-wrapper'>\r\n        <div ref={thediv} id=\"canvas-frame\" className=\"canvas-frame\"></div>\r\n        {props.children}\r\n      </div>\r\n    )\r\n  }\r\n\r\nexport { FixedMaxWidth }\r\n","import React from 'react'\r\nimport './personal_page.css'\r\n\r\n\r\nconst PersonalPage:React.FC = () =>{\r\n    return (\r\n        <a href='https://linwe2012.github.io/personal-page'>\r\n        <div className='personal-page-wrap-white'>\r\n            <img className='personal-page-avatar-white' src='https://linwe2012.github.io/personal-page/static/img/me-removebg-preview-sqr.svg' alt=''></img>\r\n            <div className='personal-page-text-white'>Lin's Personal Page</div>\r\n        </div>\r\n        </a>\r\n    )\r\n}\r\n\r\nexport default PersonalPage;","import React, { useState } from 'react';\nimport './App.css';\nimport Render from './render'\n\nimport { PrettoSlider, useStyles, FixedMaxWidth } from './bits'\nimport Grid from '@material-ui/core/Grid'\nimport Typography from '@material-ui/core/Typography';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport PersonalPage from './personal_page'\n\nconst Labels = [\n  'Lattice X', 'Lattice Y', 'Lattice Z'\n] as const\n\nconst Selects = [\n  'book', 'car', 'sphere', 'cube', 'donut'\n] as const\n\nconst App: React.FC = () => {\n  const classes = useStyles()\n  const [ctrlPointsDims, setCtrlPointsDims] = useState<[number, number, number]>([2, 2, 2])\n  const [scene, setScene] = useState(0)\n  return (\n    <div className=\"App\">\n      <Grid container className={classes.root}>\n        <Grid item xs={9}>\n        <FixedMaxWidth>\n        <Render \n          ctrlPointsDims={ctrlPointsDims}\n          scene={Selects[scene]}\n        />\n        </FixedMaxWidth>\n      </Grid>\n      <Grid item xs={3} className={classes.Right}>\n\n      <FormControl variant=\"filled\" fullWidth>\n        <InputLabel htmlFor=\"filled-scene\">Scene</InputLabel>\n        <Select\n          value={scene}\n          onChange={(e: any)=>setScene(e.target.value)}\n          inputProps={{\n            name: 'scene',\n            id: 'filled-scene',\n          }}\n        >\n          {\n            Selects.map((v, idx)=>{return (\n              <MenuItem key={idx} value={idx}>{v}</MenuItem>\n            )})\n          }\n        </Select>\n      </FormControl>\n        <div className={classes.sliderGroup}>\n        {\n          ctrlPointsDims.map((v, idx)=>{return (\n            <div style={{textAlign:'left'}} key={idx}>\n            <Typography display='inline'>\n              {Labels[idx]}\n            </Typography>\n            <PrettoSlider \n              valueLabelDisplay=\"auto\" \n              \n              onChangeCommitted={(e:any, val)=>{\n                const arr = [...ctrlPointsDims] as [number, number, number]\n                arr[idx] = Number(val)\n                setCtrlPointsDims(arr)\n              }} \n              defaultValue={2} \n              min={1} max={10}\n            />\n            </div>\n          )})\n        }\n        </div>\n        <PersonalPage></PersonalPage>\n      </Grid>\n      </Grid>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}