{"version":3,"sources":["canvas.js","traceballctrl.js","render.tsx","bits.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["CanvasManager","frame","canvas","render","onresize","w","h","pickPosition","x","y","this","clearPickPosition","clientWidth","clientHeight","appendChild","mouseout","window","addEventListener","e","event","rect","getBoundingClientRect","clientX","left","clientY","top","pos","getCanvasRelativePosition","fn","onmousemove","onmousedown","onmouseup","onclick","TrackballControls","object","domElement","_this","STATE","undefined","document","enabled","screen","width","height","rotateSpeed","zoomSpeed","panSpeed","noRotate","noZoom","noPan","staticMoving","dynamicDampingFactor","minDistance","maxDistance","Infinity","keys","mouseButtons","LEFT","MOUSE","ROTATE","MIDDLE","ZOOM","RIGHT","PAN","target","Vector3","lastPosition","lastZoom","_state","_keyState","_eye","_movePrev","Vector2","_moveCurr","_lastAxis","_lastAngle","_zoomStart","_zoomEnd","_touchZoomDistanceStart","_touchZoomDistanceEnd","_panStart","_panEnd","target0","clone","position0","position","up0","up","zoom0","zoom","changeEvent","type","startEvent","endEvent","handleResize","innerWidth","innerHeight","box","d","ownerDocument","documentElement","pageXOffset","clientLeft","pageYOffset","clientTop","getMouseOnScreen","vector","pageX","pageY","set","getMouseOnCircle","mousedown","preventDefault","stopPropagation","button","state","copy","mousemove","mouseup","dispatchEvent","removeEventListener","mousewheel","deltaMode","deltaY","touchstart","touches","length","dx","dy","Math","sqrt","touchmove","touchend","contextmenu","rotateCamera","angle","axis","quaternion","Quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","sub","normalize","crossVectors","setLength","add","setFromAxisAngle","applyQuaternion","zoomCamera","factor","isPerspectiveCamera","multiplyScalar","isOrthographicCamera","updateProjectionMatrix","console","warn","panCamera","mouseChange","objectUp","pan","lengthSq","scale_x","right","scale_y","bottom","cross","subVectors","checkDistances","addVectors","update","lookAt","distanceToSquared","reset","dispose","attachCallback","prototype","Object","create","EventDispatcher","constructor","Render","props","useState","handle","setHandle","useEffect","getElementById","scene","THREE","renderer","antialias","powerPreference","Resize","camera","Aspect","flatScene","flatCamera","currentScale","setSize","setClearColor","z","log","control","ambientLight","light","plight","light1","light2","ctrlPoints","Array","objectScene","ctrlPointsGroup","Group","STUs","dimensions","tm","requestAnimationFrame","autoClear","axies","MakeOne","color","name","group","geometry","material","cylinder","matCone","geoCone","userData","cone","n","rotation","PI","orthoAxis","axisCaster","lastAxis","params","Line","threshold","lastMouse","what","delta","setAxisColor","children","ev","setPickPosition","setFromCamera","hits","intersectObjects","parent","lastCtrlPoints","Set","ctrlKey","forEach","m","mat","Color","reflectivity","clear","moveRaycaster","UpdateCtrlPoints","dims","remove","Box3","setFromObject","Check","a","b","gap","max","min","arr","i","j","k","MakeCtrlPoint","v","xyz","dot","productRange","prd","C","ffdOnce","l","s","t","u","P","pow","X","coeff","ffd","stu","buf","Float32Array","attributes","r","needsUpdate","size","axis_proj","project","move","dst","fi","orginalBounding","ComputeSTUOnce","res","ComputeSTUOnceObj","push","array","loader","GLTFLoader","lastHepler","loadModel","path","scale","load","traverse","Mesh","BufferGeometry","helper","changeScene","metalness","roughness","mesh","updateCtrlDims","updateScene","RunAll","ctrlPointsDims","PrettoSlider","withStyles","root","thumb","backgroundColor","border","marginTop","marginLeft","boxShadow","active","valueLabel","track","borderRadius","rail","Slider","useStyles","makeStyles","theme","flexGrow","Right","maxHeight","overflowY","paddingLeft","paddingTop","spacing","slider","display","sliderGroup","FixedMaxWidth","thediv","useRef","wrap","current","style","ref","className","id","Labels","Selects","App","classes","setCtrlPointsDims","setScene","Grid","container","item","xs","FormControl","variant","fullWidth","InputLabel","htmlFor","Select","value","onChange","inputProps","map","idx","MenuItem","key","textAlign","Typography","valueLabelDisplay","onChangeCommitted","val","Number","defaultValue","Boolean","location","hostname","match","ReactDOM","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.cb88ebfd.chunk.js","sourcesContent":["// import * as THREE from 'three'\r\n\r\n// import { MapColorToDiscrete, BeginingPrime, Integration, ComputeTransformMatrix } from './utils'\r\n\r\n\r\nexport class CanvasManager {\r\n    canvas = null\r\n    w = 0\r\n    h = 0\r\n    pickPosition = {\r\n        x: 0,\r\n        y: 0\r\n    }\r\n    frame = null\r\n\r\n    constructor(frame, canvas, render, onresize) {\r\n        this.clearPickPosition()\r\n        this.canvas = canvas\r\n        this.w = frame.clientWidth\r\n        this.h = frame.clientHeight\r\n        frame.appendChild(canvas)\r\n        frame.mouseout = ()=> this.clearPickPosition()\r\n        this.frame = frame\r\n        window.addEventListener('resize', (e)=>{\r\n            this.w = this.frame.clientWidth\r\n            this.h = this.frame.clientHeight\r\n            // render.setSize(this.w, this.h)\r\n            onresize(this.w, this.h)\r\n        })\r\n    }\r\n    \r\n    set onmousemove(fn) {\r\n        this.frame.onmousemove = fn\r\n    }\r\n\r\n    set onmousedown(fn) {\r\n        this.frame.onmousedown = fn\r\n    }\r\n\r\n    set onmouseup(fn) {\r\n        this.frame.onmouseup = fn\r\n    }\r\n\r\n    set onclick(fn) {\r\n        this.frame.onclick = fn\r\n    }\r\n\r\n    Aspect() {\r\n        return this.w / this.h\r\n    }\r\n\r\n    getCanvasRelativePosition(event) {\r\n        const rect = this.canvas.getBoundingClientRect();\r\n        return {\r\n          x: event.clientX - rect.left,\r\n          y: event.clientY - rect.top,\r\n        };\r\n    }\r\n\r\n    setPickPosition(event) {\r\n        let pickPosition = this.pickPosition\r\n        const pos = this.getCanvasRelativePosition(event);\r\n        pickPosition.x = (pos.x / this.w) *  2 - 1;\r\n        pickPosition.y = (pos.y / this.h) * -2 + 1;  // note we flip Y\r\n    }\r\n\r\n    clearPickPosition() {\r\n        let pickPosition = this.pickPosition\r\n        pickPosition.x = -100000;\r\n        pickPosition.y = -100000;\r\n    }\r\n}","/**\r\n * @author Eberhard Graether / http://egraether.com/\r\n * @author Mark Lundin \t/ http://mark-lundin.com\r\n * @author Simone Manini / http://daron1337.github.io\r\n * @author Luca Antiga \t/ http://lantiga.github.io\r\n */\r\n\r\nimport {\r\n\tEventDispatcher,\r\n\tMOUSE,\r\n\tQuaternion,\r\n\tVector2,\r\n\tVector3\r\n} from \"three\";\r\n\r\nvar TrackballControls = function ( object, domElement ) {\r\n\r\n\tvar _this = this;\r\n\tvar STATE = { NONE: - 1, ROTATE: 0, ZOOM: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_ZOOM_PAN: 4 };\r\n\r\n\tthis.object = object;\r\n\tthis.domElement = ( domElement !== undefined ) ? domElement : document;\r\n\r\n\t// API\r\n\r\n\tthis.enabled = true;\r\n\r\n\tthis.screen = { left: 0, top: 0, width: 0, height: 0 };\r\n\r\n\tthis.rotateSpeed = 1.0;\r\n\tthis.zoomSpeed = 1.2;\r\n\tthis.panSpeed = 0.3;\r\n\r\n\tthis.noRotate = false;\r\n\tthis.noZoom = false;\r\n\tthis.noPan = false;\r\n\r\n\tthis.staticMoving = false;\r\n\tthis.dynamicDampingFactor = 0.2;\r\n\r\n\tthis.minDistance = 0;\r\n\tthis.maxDistance = Infinity;\r\n\r\n\tthis.keys = [ 65 /*A*/, 83 /*S*/, 68 /*D*/ ];\r\n\r\n\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.ZOOM, RIGHT: MOUSE.PAN };\r\n\r\n\t// internals\r\n\r\n\tthis.target = new Vector3();\r\n\r\n\tvar EPS = 0.000001;\r\n\r\n\tvar lastPosition = new Vector3();\r\n\tvar lastZoom = 1;\r\n\r\n\tvar _state = STATE.NONE,\r\n\t\t_keyState = STATE.NONE,\r\n\r\n\t\t_eye = new Vector3(),\r\n\r\n\t\t_movePrev = new Vector2(),\r\n\t\t_moveCurr = new Vector2(),\r\n\r\n\t\t_lastAxis = new Vector3(),\r\n\t\t_lastAngle = 0,\r\n\r\n\t\t_zoomStart = new Vector2(),\r\n\t\t_zoomEnd = new Vector2(),\r\n\r\n\t\t_touchZoomDistanceStart = 0,\r\n\t\t_touchZoomDistanceEnd = 0,\r\n\r\n\t\t_panStart = new Vector2(),\r\n\t\t_panEnd = new Vector2();\r\n\r\n\t// for reset\r\n\r\n\tthis.target0 = this.target.clone();\r\n\tthis.position0 = this.object.position.clone();\r\n\tthis.up0 = this.object.up.clone();\r\n\tthis.zoom0 = this.object.zoom;\r\n\r\n\t// events\r\n\r\n\tvar changeEvent = { type: 'change' };\r\n\tvar startEvent = { type: 'start' };\r\n\tvar endEvent = { type: 'end' };\r\n\r\n\r\n\t// methods\r\n\r\n\tthis.handleResize = function () {\r\n\r\n\t\tif ( this.domElement === document ) {\r\n\r\n\t\t\tthis.screen.left = 0;\r\n\t\t\tthis.screen.top = 0;\r\n\t\t\tthis.screen.width = window.innerWidth;\r\n\t\t\tthis.screen.height = window.innerHeight;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar box = this.domElement.getBoundingClientRect();\r\n\t\t\t// adjustments come from similar code in the jquery offset() function\r\n\t\t\tvar d = this.domElement.ownerDocument.documentElement;\r\n\t\t\tthis.screen.left = box.left + window.pageXOffset - d.clientLeft;\r\n\t\t\tthis.screen.top = box.top + window.pageYOffset - d.clientTop;\r\n\t\t\tthis.screen.width = box.width;\r\n\t\t\tthis.screen.height = box.height;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tvar getMouseOnScreen = ( function () {\r\n\r\n\t\tvar vector = new Vector2();\r\n\r\n\t\treturn function getMouseOnScreen( pageX, pageY ) {\r\n\r\n\t\t\tvector.set(\r\n\t\t\t\t( pageX - _this.screen.left ) / _this.screen.width,\r\n\t\t\t\t( pageY - _this.screen.top ) / _this.screen.height\r\n\t\t\t);\r\n\r\n\t\t\treturn vector;\r\n\r\n\t\t};\r\n\r\n\t}() );\r\n\r\n\tvar getMouseOnCircle = ( function () {\r\n\r\n\t\tvar vector = new Vector2();\r\n\r\n\t\treturn function getMouseOnCircle( pageX, pageY ) {\r\n\r\n\t\t\tvector.set(\r\n\t\t\t\t( ( pageX - _this.screen.width * 0.5 - _this.screen.left ) / ( _this.screen.width * 0.5 ) ),\r\n\t\t\t\t( ( _this.screen.height + 2 * ( _this.screen.top - pageY ) ) / _this.screen.width ) // screen.width intentional\r\n\t\t\t);\r\n\r\n\t\t\treturn vector;\r\n\r\n\t\t};\r\n\r\n\t}() );\r\n\r\n\tthis.rotateCamera = ( function () {\r\n\r\n\t\tvar axis = new Vector3(),\r\n\t\t\tquaternion = new Quaternion(),\r\n\t\t\teyeDirection = new Vector3(),\r\n\t\t\tobjectUpDirection = new Vector3(),\r\n\t\t\tobjectSidewaysDirection = new Vector3(),\r\n\t\t\tmoveDirection = new Vector3(),\r\n\t\t\tangle;\r\n\r\n\t\treturn function rotateCamera() {\r\n\r\n\t\t\tmoveDirection.set( _moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0 );\r\n\t\t\tangle = moveDirection.length();\r\n\r\n\t\t\tif ( angle ) {\r\n\r\n\t\t\t\t_eye.copy( _this.object.position ).sub( _this.target );\r\n\r\n\t\t\t\teyeDirection.copy( _eye ).normalize();\r\n\t\t\t\tobjectUpDirection.copy( _this.object.up ).normalize();\r\n\t\t\t\tobjectSidewaysDirection.crossVectors( objectUpDirection, eyeDirection ).normalize();\r\n\r\n\t\t\t\tobjectUpDirection.setLength( _moveCurr.y - _movePrev.y );\r\n\t\t\t\tobjectSidewaysDirection.setLength( _moveCurr.x - _movePrev.x );\r\n\r\n\t\t\t\tmoveDirection.copy( objectUpDirection.add( objectSidewaysDirection ) );\r\n\r\n\t\t\t\taxis.crossVectors( moveDirection, _eye ).normalize();\r\n\r\n\t\t\t\tangle *= _this.rotateSpeed;\r\n\t\t\t\tquaternion.setFromAxisAngle( axis, angle );\r\n\r\n\t\t\t\t_eye.applyQuaternion( quaternion );\r\n\t\t\t\t_this.object.up.applyQuaternion( quaternion );\r\n\r\n\t\t\t\t_lastAxis.copy( axis );\r\n\t\t\t\t_lastAngle = angle;\r\n\r\n\t\t\t} else if ( ! _this.staticMoving && _lastAngle ) {\r\n\r\n\t\t\t\t_lastAngle *= Math.sqrt( 1.0 - _this.dynamicDampingFactor );\r\n\t\t\t\t_eye.copy( _this.object.position ).sub( _this.target );\r\n\t\t\t\tquaternion.setFromAxisAngle( _lastAxis, _lastAngle );\r\n\t\t\t\t_eye.applyQuaternion( quaternion );\r\n\t\t\t\t_this.object.up.applyQuaternion( quaternion );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_movePrev.copy( _moveCurr );\r\n\r\n\t\t};\r\n\r\n\t}() );\r\n\r\n\r\n\tthis.zoomCamera = function () {\r\n\r\n\t\tvar factor;\r\n\r\n\t\tif ( _state === STATE.TOUCH_ZOOM_PAN ) {\r\n\r\n\t\t\tfactor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\r\n\t\t\t_touchZoomDistanceStart = _touchZoomDistanceEnd;\r\n\r\n\t\t\tif ( _this.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t\t_eye.multiplyScalar( factor );\r\n\r\n\t\t\t} else if ( _this.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\t_this.object.zoom *= factor;\r\n\t\t\t\t_this.object.updateProjectionMatrix();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfactor = 1.0 + ( _zoomEnd.y - _zoomStart.y ) * _this.zoomSpeed;\r\n\r\n\t\t\tif ( factor !== 1.0 && factor > 0.0 ) {\r\n\r\n\t\t\t\tif ( _this.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t\t\t_eye.multiplyScalar( factor );\r\n\r\n\t\t\t\t} else if ( _this.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\t\t_this.object.zoom /= factor;\r\n\t\t\t\t\t_this.object.updateProjectionMatrix();\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( _this.staticMoving ) {\r\n\r\n\t\t\t\t_zoomStart.copy( _zoomEnd );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_zoomStart.y += ( _zoomEnd.y - _zoomStart.y ) * this.dynamicDampingFactor;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.panCamera = ( function () {\r\n\r\n\t\tvar mouseChange = new Vector2(),\r\n\t\t\tobjectUp = new Vector3(),\r\n\t\t\tpan = new Vector3();\r\n\r\n\t\treturn function panCamera() {\r\n\r\n\t\t\tmouseChange.copy( _panEnd ).sub( _panStart );\r\n\r\n\t\t\tif ( mouseChange.lengthSq() ) {\r\n\r\n\t\t\t\tif ( _this.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\t\tvar scale_x = ( _this.object.right - _this.object.left ) / _this.object.zoom / _this.domElement.clientWidth;\r\n\t\t\t\t\tvar scale_y = ( _this.object.top - _this.object.bottom ) / _this.object.zoom / _this.domElement.clientWidth;\r\n\r\n\t\t\t\t\tmouseChange.x *= scale_x;\r\n\t\t\t\t\tmouseChange.y *= scale_y;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmouseChange.multiplyScalar( _eye.length() * _this.panSpeed );\r\n\r\n\t\t\t\tpan.copy( _eye ).cross( _this.object.up ).setLength( mouseChange.x );\r\n\t\t\t\tpan.add( objectUp.copy( _this.object.up ).setLength( mouseChange.y ) );\r\n\r\n\t\t\t\t_this.object.position.add( pan );\r\n\t\t\t\t_this.target.add( pan );\r\n\r\n\t\t\t\tif ( _this.staticMoving ) {\r\n\r\n\t\t\t\t\t_panStart.copy( _panEnd );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t_panStart.add( mouseChange.subVectors( _panEnd, _panStart ).multiplyScalar( _this.dynamicDampingFactor ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}() );\r\n\r\n\tthis.checkDistances = function () {\r\n\r\n\t\tif ( ! _this.noZoom || ! _this.noPan ) {\r\n\r\n\t\t\tif ( _eye.lengthSq() > _this.maxDistance * _this.maxDistance ) {\r\n\r\n\t\t\t\t_this.object.position.addVectors( _this.target, _eye.setLength( _this.maxDistance ) );\r\n\t\t\t\t_zoomStart.copy( _zoomEnd );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( _eye.lengthSq() < _this.minDistance * _this.minDistance ) {\r\n\r\n\t\t\t\t_this.object.position.addVectors( _this.target, _eye.setLength( _this.minDistance ) );\r\n\t\t\t\t_zoomStart.copy( _zoomEnd );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.update = function () {\r\n\r\n\t\t_eye.subVectors( _this.object.position, _this.target );\r\n\r\n\t\tif ( ! _this.noRotate ) {\r\n\r\n\t\t\t_this.rotateCamera();\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! _this.noZoom ) {\r\n\r\n\t\t\t_this.zoomCamera();\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! _this.noPan ) {\r\n\r\n\t\t\t_this.panCamera();\r\n\r\n\t\t}\r\n\r\n\t\t_this.object.position.addVectors( _this.target, _eye );\r\n\r\n\t\tif ( _this.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t_this.checkDistances();\r\n\r\n\t\t\t_this.object.lookAt( _this.target );\r\n\r\n\t\t\tif ( lastPosition.distanceToSquared( _this.object.position ) > EPS ) {\r\n\r\n\t\t\t\t_this.dispatchEvent( changeEvent );\r\n\r\n\t\t\t\tlastPosition.copy( _this.object.position );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( _this.object.isOrthographicCamera ) {\r\n\r\n\t\t\t_this.object.lookAt( _this.target );\r\n\r\n\t\t\tif ( lastPosition.distanceToSquared( _this.object.position ) > EPS || lastZoom !== _this.object.zoom ) {\r\n\r\n\t\t\t\t_this.dispatchEvent( changeEvent );\r\n\r\n\t\t\t\tlastPosition.copy( _this.object.position );\r\n\t\t\t\tlastZoom = _this.object.zoom;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.reset = function () {\r\n\r\n\t\t_state = STATE.NONE;\r\n\t\t_keyState = STATE.NONE;\r\n\r\n\t\t_this.target.copy( _this.target0 );\r\n\t\t_this.object.position.copy( _this.position0 );\r\n\t\t_this.object.up.copy( _this.up0 );\r\n\t\t_this.object.zoom = _this.zoom0;\r\n\r\n\t\t_this.object.updateProjectionMatrix();\r\n\r\n\t\t_eye.subVectors( _this.object.position, _this.target );\r\n\r\n\t\t_this.object.lookAt( _this.target );\r\n\r\n\t\t_this.dispatchEvent( changeEvent );\r\n\r\n\t\tlastPosition.copy( _this.object.position );\r\n\t\tlastZoom = _this.object.zoom;\r\n\r\n\t};\r\n\r\n\t// listeners\r\n\r\n\tfunction mousedown( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tif ( _state === STATE.NONE ) {\r\n\r\n\t\t\tswitch ( event.button ) {\r\n\r\n\t\t\t\tcase _this.mouseButtons.LEFT:\r\n\t\t\t\t\t_state = STATE.ROTATE;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase _this.mouseButtons.MIDDLE:\r\n\t\t\t\t\t_state = STATE.ZOOM;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase _this.mouseButtons.RIGHT:\r\n\t\t\t\t\t_state = STATE.PAN;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t_state = STATE.NONE;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\r\n\r\n\t\tif ( state === STATE.ROTATE && ! _this.noRotate ) {\r\n\r\n\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\r\n\t\t\t_movePrev.copy( _moveCurr );\r\n\r\n\t\t} else if ( state === STATE.ZOOM && ! _this.noZoom ) {\r\n\r\n\t\t\t_zoomStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\r\n\t\t\t_zoomEnd.copy( _zoomStart );\r\n\r\n\t\t} else if ( state === STATE.PAN && ! _this.noPan ) {\r\n\r\n\t\t\t_panStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\r\n\t\t\t_panEnd.copy( _panStart );\r\n\r\n\t\t}\r\n\r\n\t\tdocument.addEventListener( 'mousemove', mousemove, false );\r\n\t\tdocument.addEventListener( 'mouseup', mouseup, false );\r\n\r\n\t\t_this.dispatchEvent( startEvent );\r\n\r\n\t}\r\n\r\n\tfunction mousemove( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tvar state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\r\n\r\n\t\tif ( state === STATE.ROTATE && ! _this.noRotate ) {\r\n\r\n\t\t\t_movePrev.copy( _moveCurr );\r\n\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\r\n\r\n\t\t} else if ( state === STATE.ZOOM && ! _this.noZoom ) {\r\n\r\n\t\t\t_zoomEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\r\n\r\n\t\t} else if ( state === STATE.PAN && ! _this.noPan ) {\r\n\r\n\t\t\t_panEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction mouseup( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\t_state = STATE.NONE;\r\n\r\n\t\tdocument.removeEventListener( 'mousemove', mousemove );\r\n\t\tdocument.removeEventListener( 'mouseup', mouseup );\r\n\t\t_this.dispatchEvent( endEvent );\r\n\r\n\t}\r\n\r\n\tfunction mousewheel( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tif ( _this.noZoom === true ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tswitch ( event.deltaMode ) {\r\n\r\n\t\t\tcase 2:\r\n\t\t\t\t// Zoom in pages\r\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.025;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\t// Zoom in lines\r\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.01;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\t// undefined, 0, assume pixels\r\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.00025;\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\t_this.dispatchEvent( startEvent );\r\n\t\t_this.dispatchEvent( endEvent );\r\n\r\n\t}\r\n\r\n\tfunction touchstart( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tswitch ( event.touches.length ) {\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\r\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\r\n\t\t\t\t_movePrev.copy( _moveCurr );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault: // 2 or more\r\n\t\t\t\t_state = STATE.TOUCH_ZOOM_PAN;\r\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\r\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\r\n\t\t\t\t_touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\r\n\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\r\n\t\t\t\t_panStart.copy( getMouseOnScreen( x, y ) );\r\n\t\t\t\t_panEnd.copy( _panStart );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\t_this.dispatchEvent( startEvent );\r\n\r\n\t}\r\n\r\n\tfunction touchmove( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tswitch ( event.touches.length ) {\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\t_movePrev.copy( _moveCurr );\r\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault: // 2 or more\r\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\r\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\r\n\t\t\t\t_touchZoomDistanceEnd = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\r\n\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\r\n\t\t\t\t_panEnd.copy( getMouseOnScreen( x, y ) );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction touchend( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tswitch ( event.touches.length ) {\r\n\r\n\t\t\tcase 0:\r\n\t\t\t\t_state = STATE.NONE;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\r\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\r\n\t\t\t\t_movePrev.copy( _moveCurr );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\t_this.dispatchEvent( endEvent );\r\n\r\n\t}\r\n\r\n\tfunction contextmenu( event ) {\r\n\r\n\t\tif ( _this.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t}\r\n\r\n\tthis.dispose = function () {\r\n\r\n\t\tthis.domElement.removeEventListener( 'contextmenu', contextmenu, false );\r\n\t\tthis.domElement.removeEventListener( 'mousedown', mousedown, false );\r\n\t\tthis.domElement.removeEventListener( 'wheel', mousewheel, false );\r\n\r\n\t\tthis.domElement.removeEventListener( 'touchstart', touchstart, false );\r\n\t\tthis.domElement.removeEventListener( 'touchend', touchend, false );\r\n\t\tthis.domElement.removeEventListener( 'touchmove', touchmove, false );\r\n\r\n\t\tdocument.removeEventListener( 'mousemove', mousemove, false );\r\n\t\tdocument.removeEventListener( 'mouseup', mouseup, false );\r\n\r\n\t\t// window.removeEventListener( 'keydown', keydown, false );\r\n\t\t// window.removeEventListener( 'keyup', keyup, false );\r\n\r\n\t};\r\n\r\n\r\n\tthis.attachCallback = function () {\r\n\t\tthis.domElement.addEventListener( 'contextmenu', contextmenu, false );\r\n\t\tthis.domElement.addEventListener( 'mousedown', mousedown, false );\r\n\t\tthis.domElement.addEventListener( 'wheel', mousewheel, false );\r\n\r\n\t\tthis.domElement.addEventListener( 'touchstart', touchstart, false );\r\n\t\tthis.domElement.addEventListener( 'touchend', touchend, false );\r\n\t\tthis.domElement.addEventListener( 'touchmove', touchmove, false );\r\n\t}\r\n\r\n\tthis.attachCallback()\r\n\t//this.domElement.addEventListener( 'contextmenu', contextmenu, false );\r\n\t//this.domElement.addEventListener( 'mousedown', mousedown, false );\r\n\t//this.domElement.addEventListener( 'wheel', mousewheel, false );\r\n\r\n\t//this.domElement.addEventListener( 'touchstart', touchstart, false );\r\n\t//this.domElement.addEventListener( 'touchend', touchend, false );\r\n\t//this.domElement.addEventListener( 'touchmove', touchmove, false );\r\n\r\n\t// window.addEventListener( 'keydown', keydown, false );\r\n\t// window.addEventListener( 'keyup', keyup, false );\r\n\r\n\tthis.handleResize();\r\n\r\n\t// force an update at start\r\n\tthis.update();\r\n\r\n};\r\n\r\nTrackballControls.prototype = Object.create( EventDispatcher.prototype );\r\nTrackballControls.prototype.constructor = TrackballControls;\r\n\r\nexport { TrackballControls };\r\n","import React, { useEffect, useState } from 'react'\r\nimport { CanvasManager } from './canvas'\r\nimport * as THREE from 'three'\r\nimport { TrackballControls } from './traceballctrl'\r\n//import { TrackballControls } from 'three/examples/jsm/controls/TrackballControls'\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport { Box3, Group, Mesh, BufferGeometry, BufferAttribute, MeshBasicMaterial, Color } from 'three'\r\n// import { DragControls } from 'three/examples/jsm/controls/DragControls'\r\n\r\ninterface RenderProps {\r\n    ctrlPointsDims: [number, number, number]\r\n    scene:string\r\n}\r\n\r\ninterface STU {\r\n    object: Mesh\r\n    stu: Float32Array\r\n}\r\n\r\nconst Render : React.FC<RenderProps> = (props)=>{\r\n    const [handle, setHandle] = useState<ReturnType<typeof RunAll>>()\r\n    useEffect(()=>{\r\n        setHandle(RunAll())\r\n    }, [])\r\n\r\n    // eslint-disable: react-hooks/exhaustive-deps\r\n    useEffect(()=>{\r\n        if(handle){\r\n            const dims = props.ctrlPointsDims\r\n            handle.updateCtrlDims(...dims)\r\n        }\r\n    }, [props.ctrlPointsDims])\r\n\r\n    // eslint-disable-next-line\r\n    useEffect(()=>{\r\n        if(handle) {\r\n            handle.updateScene(props.scene)\r\n        }\r\n    }, [props.scene])\r\n\r\n    return (null)\r\n}\r\n\r\nexport default Render;\r\n\r\n\r\n\r\nfunction RunAll () {\r\nconst HandleResize = ()=>{Resize()}\r\nconst frame = document.getElementById('canvas-frame'); if(frame === null) return;\r\nconst scene = new THREE.Scene();\r\nconst renderer = new THREE.WebGLRenderer({antialias : true, powerPreference:'high-performance'});\r\nconst canvas = new CanvasManager(frame, renderer.domElement, renderer, HandleResize);\r\nconst camera = new THREE.PerspectiveCamera(75, canvas.Aspect(), 0.1, 1000);\r\nconst flatScene = new THREE.Scene()\r\nconst flatCamera = new THREE.PerspectiveCamera(75, canvas.Aspect(), 0.1, 1000);\r\nlet currentScale = 0.1\r\n\r\nrenderer.setSize(canvas.w, canvas.h);\r\nrenderer.setClearColor(0x444444, 1.0);\r\n\r\ncamera.position.z = 5;\r\nflatCamera.position.z = 5\r\nvar Resize=() => {\r\n    console.log(canvas.w, canvas.h)\r\n    // camera.aspect = canvas.Aspect()\r\n    // camera.updateMatrix()\r\n}\r\nconst control = new TrackballControls(camera, frame)\r\n// const fpControl = new KeyControls(camera, frame)\r\ncontrol.target.set(0, 0, 0)\r\ncontrol.rotateSpeed = 8.0;\r\ncontrol.noPan = false\r\ncontrol.maxDistance = 60\r\ncontrol.keys = []\r\ncontrol.dispose()\r\nconst ambientLight = new THREE.AmbientLight( 0x404040 ); // soft white light\r\nscene.add( ambientLight );\r\nvar light = new THREE.PointLight( 0xffffff, 1, 100 );\r\nlight.position.set( 10, 10, 10 );\r\nscene.add( light );\r\n\r\nvar plight = new THREE.PointLight( 0xffffff, 1, 200 );\r\nplight.position.set( -40, 20, 20 );\r\nscene.add( plight );\r\n\r\nvar light1 = new THREE.PointLight( 0xffffff, 1, 200 );\r\nlight1.position.set( -40, -20, -20 );\r\nscene.add( light1 );\r\n\r\nvar light2 = new THREE.PointLight( 0xffffff, 1, 200 );\r\nlight2.position.set( -20, 10, -10 );\r\nscene.add( light2 );\r\n\r\nlet ctrlPoints = new Array<Array<Array<THREE.Vector3>>>()\r\nlet objectScene : THREE.Scene | THREE.Object3D | null = null\r\nlet ctrlPointsGroup = new Group()\r\nlet STUs = new Array<STU>()\r\nlet dimensions = new THREE.Vector3(2, 2, 2)\r\n// let bounding = new Box3()\r\n\r\nscene.add(ctrlPointsGroup)\r\n\r\nfunction render(tm : number) {\r\n    requestAnimationFrame(render);\r\n    renderer.autoClear = true;\r\n    renderer.render(scene, camera);\r\n    renderer.autoClear = false;\r\n    renderer.render(flatScene, flatCamera)\r\n    // fpControl.update(tm - lastTm)\r\n    control.update();\r\n}\r\nrender(0);\r\n\r\nconst axies = new THREE.Group()\r\nscene.add(axies)\r\n\r\nconst MakeOne = (x: number, y: number, z: number, color: number, name ?: string)=>{\r\n    const group = new THREE.Group();\r\n    var geometry = new THREE.CylinderGeometry( 0.015, 0.015, x||y||z, 3 );\r\n    var material = new THREE.MeshBasicMaterial( {color: color} );\r\n    var cylinder = new THREE.Mesh( geometry, material );\r\n    cylinder.position.set(x/2,y/2,z/2)\r\n    \r\n    const matCone = new THREE.ConeGeometry( 0.05, 0.1, 6 );\r\n    \r\n    const geoCone = new THREE.MeshBasicMaterial( {color: color} );\r\n    cylinder.userData = { name: name, color:color, axis: new THREE.Vector3(x, y, z) }\r\n\r\n    const cone = new THREE.Mesh( matCone, geoCone );\r\n    cone.position.set(x, y, z)\r\n    const n = cone.position.clone().normalize()\r\n    cone.rotation.set(n.z * Math.PI / 2, n.y * Math.PI / 2, -n.x * Math.PI / 2)\r\n    cone.userData = { name: name, color:color, axis: new THREE.Vector3(x, y, z) }\r\n    cylinder.rotation.set(n.z * Math.PI / 2, n.y * Math.PI / 2, -n.x * Math.PI / 2)\r\n    \r\n    group.userData = { name: name, color:color, axis: new THREE.Vector3(x, y, z) }\r\n    group.add(cylinder, cone)\r\n    return group;\r\n}\r\n\r\nconst axisLength = 0.6 as const\r\n\r\n{\r\n    const group = MakeOne(axisLength, 0, 0, 0xffff00, 'x')\r\n    axies.add(group)\r\n}\r\n{\r\n    const group = MakeOne(0, axisLength, 0, 0xff00ff, 'y')\r\n    axies.add(group)\r\n}\r\n{\r\n    const group = MakeOne(0, 0, axisLength, 0x00aaff, 'z')\r\n    axies.add(group)\r\n}\r\n\r\nconst orthoAxis = new THREE.Group()\r\n\r\nflatScene.add(orthoAxis)\r\n{\r\n    const group = MakeOne(1, 0, 0, 0xffff00)\r\n    orthoAxis.add(group)\r\n}\r\n{\r\n    const group = MakeOne(0, 1, 0, 0xff00ff)\r\n    orthoAxis.add(group)\r\n}\r\n{\r\n    const group = MakeOne(0, 0, 0.5, 0x00aaff)\r\n    orthoAxis.add(group)\r\n}\r\northoAxis.position.set(-6 * canvas.Aspect(), -6 , -4.6)\r\n\r\nconst axisCaster = new THREE.Raycaster()\r\nlet lastAxis : THREE.Group | null = null\r\n// axisCaster.linePrecision = 0.05;\r\n// axisCaster.params = { Line: { threshold: 100 } }\r\naxisCaster.params.Line = { threshold:5 }\r\nlet mousedown = false\r\nlet lastMouse = {\r\n    x: 0,\r\n    y: 0,\r\n    update: (what:{x:number,y:number}) => {\r\n        let delta = new THREE.Vector3(\r\n            what.x - lastMouse.x,\r\n            what.y - lastMouse.y\r\n        )\r\n        lastMouse.x = what.x\r\n        lastMouse.y = what.y\r\n        return delta;\r\n    },\r\n    clone: () => {\r\n        return {\r\n            x: lastMouse.x,\r\n            y: lastMouse.y\r\n        }\r\n    }\r\n}\r\n\r\nconst setAxisColor = (color:number) => {\r\n    if(!lastAxis) return;\r\n    ((lastAxis.children[0] as Mesh).material as MeshBasicMaterial).color.set( color );\r\n    ((lastAxis.children[1] as Mesh).material as MeshBasicMaterial).color.set( color );\r\n}\r\n\r\n\r\n//frame.onmousedown \r\n\r\nconst onmousedown = (ev:MouseEvent)=>{\r\n    console.log('On mouse down')\r\n    mousedown = true\r\n    canvas.setPickPosition(ev)\r\n    lastMouse.update(canvas.pickPosition)\r\n    axisCaster.setFromCamera(canvas.pickPosition, camera);\r\n    const hits = axisCaster.intersectObjects(axies.children, true)\r\n    if(lastAxis !== null) {\r\n        setAxisColor( lastAxis.userData.color );\r\n        lastAxis = null\r\n    }\r\n    if(hits.length) {\r\n        control.enabled = false;\r\n        lastAxis = hits[0].object.parent as Group;\r\n        setAxisColor( 0xffffff );\r\n    }\r\n}\r\nframe.onmousedown = onmousedown\r\n\r\nlet lastCtrlPoints = new Set<Mesh>()\r\n\r\nconst clearSelected = ()=>{\r\n    lastCtrlPoints.forEach(m=>{\r\n        const mat = (m.material as THREE.MeshLambertMaterial);\r\n        // mat.emissive = new THREE.Color(0xbbbbbb);\r\n        mat.color = new Color(0x999999)\r\n        mat.reflectivity = 1\r\n    });\r\n    lastCtrlPoints.clear()\r\n}\r\n\r\n\r\nframe.onclick = (ev)=>{\r\n    canvas.setPickPosition(ev)\r\n    axisCaster.setFromCamera(canvas.pickPosition, camera);\r\n    const hits = axisCaster.intersectObjects(ctrlPointsGroup.children)\r\n    if(hits.length) {\r\n        if(!ev.ctrlKey) {\r\n            clearSelected()   \r\n        }\r\n        lastCtrlPoints.add(hits[0].object as Mesh);\r\n        const mat  = (hits[0].object as THREE.Mesh).material as THREE.MeshLambertMaterial;\r\n        // mat.emissive = new THREE.Color(0x99ffee);\r\n        mat.color = new Color(0xbb44ff)\r\n        mat.reflectivity = 1.4\r\n        const pos = hits[0].object.position\r\n        axies.position.set(pos.x, pos.y, pos.z)\r\n    }\r\n}\r\n\r\nconst moveRaycaster = new THREE.Raycaster();\r\n\r\nframe.onmousemove = (ev)=>{\r\n    if(lastAxis === null || !mousedown || !lastCtrlPoints.size) {\r\n        return\r\n    }\r\n    canvas.setPickPosition(ev)\r\n    const delta = lastMouse.update(canvas.pickPosition)\r\n    if(delta.length() === 0) return;\r\n    const axis = lastAxis.userData.axis as THREE.Vector3\r\n    const axis_proj = axis.clone().project(camera);\r\n    //const axis_proj2d = axis_proj.clone();\r\n    axis_proj.z = 0\r\n\r\n    moveRaycaster.setFromCamera(canvas.pickPosition, camera);\r\n\r\n    const raw_move = axis_proj.dot(delta) / axis_proj.length();\r\n    //const dst = axis_proj2d.multiplyScalar(raw_move).add(axis_proj);\r\n\r\n    ///axis_proj.x += axis_proj2d.x\r\n    //axis_proj.y += axis_proj2d.y\r\n    //const dst = axis_proj.unproject(camera);\r\n    //axies.position.set(dst.x, dst.y, dst.z);\r\n\r\n    const move = raw_move * (axisLength / axis_proj.length()) * 0.76;\r\n    const dst = axis.clone().multiplyScalar(move); // move direction vector\r\n    \r\n    // dst.add(axies.position)\r\n    \r\n    axies.position.add(dst);\r\n\r\n    lastCtrlPoints.forEach(m=>{\r\n        m.position.add(dst)\r\n        const fi = m.position;\r\n        const xyz = m.userData.xyz\r\n        ctrlPoints[xyz[0]][xyz[1]][xyz[2]].set(fi.x, fi.y, fi.z);\r\n    })\r\n    ffd();\r\n}\r\n\r\nframe.onmouseup = (ev)=>{\r\n    mousedown = false\r\n    control.enabled = true\r\n    if(lastAxis !== null) {\r\n        setAxisColor( lastAxis.userData.color )\r\n        \r\n        lastAxis = null\r\n    }\r\n}\r\n\r\nfunction MakeCtrlPoint(dims : THREE.Vector3, box : THREE.Box3, fn: (v:THREE.Vector3, xyz: number[])=>any) {\r\n    const gap = box.max.clone().sub(box.min)\r\n    const arr = new Array<Array<Array<THREE.Vector3>>>()\r\n    \r\n    for(let i = 0; i < dims.x + 1; ++i) {\r\n        arr[i] = new Array<Array<THREE.Vector3>>()\r\n        for(let j = 0; j < dims.y + 1; ++j) {\r\n            arr[i][j] = new Array<THREE.Vector3>()\r\n            for(let k = 0; k < dims.z + 1; ++k) {\r\n                arr[i][j][k] = new THREE.Vector3(\r\n                    gap.x / dims.x * i,\r\n                    gap.y / dims.y * j,\r\n                    gap.z / dims.z * k,\r\n                )\r\n                arr[i][j][k].add(box.min)\r\n                fn(arr[i][j][k], [i, j, k])\r\n            }\r\n        }\r\n    }\r\n    return arr\r\n}\r\n\r\n\r\n// children[0]: lines\r\n// children[1]: plane\r\n// const lattices = new THREE.Group();\r\n\r\nfunction UpdateCtrlPoints(dims : THREE.Vector3) {\r\n    if(objectScene === null) {\r\n        return\r\n    }\r\n\r\n    dimensions = dims\r\n    while (ctrlPointsGroup.children.length)\r\n    {\r\n        ctrlPointsGroup.remove(ctrlPointsGroup.children[0]);\r\n    }\r\n\r\n    let box = new Box3().setFromObject(objectScene);\r\n    console.log(box)\r\n    // bounding = box\r\n    const Check = (a : number, b : number)=>{\r\n        return a === 0 || a === b\r\n    }\r\n    ctrlPoints = MakeCtrlPoint(dims, box, (v, xyz)=>{\r\n        if(!(Check(xyz[0], dims.x) || Check(xyz[1], dims.y) || Check(xyz[2], dims.z))) return;\r\n        let geometry = new THREE.SphereGeometry(0.042, 16, 16)\r\n        let material = new THREE.MeshLambertMaterial({color:0xaaaaaa});\r\n        let dot = new THREE.Mesh(geometry, material)\r\n        dot.position.set(v.x, v.y, v.z)\r\n        dot.userData = { xyz: xyz }\r\n        ctrlPointsGroup.add(dot)\r\n    })\r\n}\r\n\r\nfunction productRange(a:number, b:number) {\r\n    let prd = a, i = a;\r\n    while(i++ < b) {\r\n        prd *= i\r\n    }\r\n    return prd\r\n}\r\n\r\nfunction C(n:number, k:number) {\r\n    k = (k < n-k) ? n-k : k // this must go first\r\n    if(n === k) return 1;\r\n    return productRange(k+1, n) / productRange(1, n-k)\r\n}\r\n\r\nfunction ffdOnce(l:number, m:number, n:number, s:number, t:number, u:number, P:THREE.Vector3[][][] /*ctrl point*/) {\r\n    const pow = Math.pow\r\n    const X = new THREE.Vector3(0,0,0)\r\n    for(let i = 0; i <= l; ++i) {\r\n        for(let j = 0; j <= m; ++j) {\r\n            for(let k = 0; k <= n; ++k) {\r\n                const coeff = \r\n                    C(l,i)*pow(1-s,l-i)*pow(s,i)* // bernstein\r\n                    C(m,j)*pow(1-t,m-j)*pow(t,j)*\r\n                    C(n,k)*pow(1-u,n-k)*pow(u,k)\r\n                X.add(P[i][j][k].clone().multiplyScalar(coeff))\r\n            }\r\n        }\r\n    }\r\n    X.multiplyScalar(1/currentScale)\r\n    return X\r\n}\r\n\r\nfunction ffd() {\r\n    for(let stu of STUs) {\r\n        let v = stu.stu\r\n        let buf = new Float32Array(v.length);\r\n        let pos = (stu.object.geometry as BufferGeometry).attributes.position as BufferAttribute;\r\n        \r\n        for(let i = 0; i < v.length; i+=3){\r\n            let r = ffdOnce(dimensions.x, dimensions.y, dimensions.z, v[i], v[i+1], v[i+2], ctrlPoints);\r\n            buf[i]   = r.x\r\n            buf[i+1] = r.y\r\n            buf[i+2] = r.z\r\n        }\r\n        pos.set(buf)\r\n        pos.needsUpdate = true\r\n    }\r\n}\r\n\r\nlet orginalBounding = new THREE.Box3()\r\n\r\nfunction ComputeSTUOnce(v : ArrayLike<number>, box:Box3) {\r\n    const res = new Float32Array(v.length)\r\n    const gap = box.max.clone().sub(box.min)\r\n    for(let i = 0; i < v.length;++i){\r\n        res[i] = (v[i] - box.min.x) / gap.x\r\n        ++i;\r\n        res[i] = (v[i] - box.min.y) / gap.y\r\n        ++i;\r\n        res[i] = (v[i] - box.min.z) / gap.z\r\n    }\r\n    return res\r\n}\r\n\r\nfunction ComputeSTUOnceObj(object:Mesh) {\r\n    STUs.push(\r\n        {\r\n            object: object,\r\n            stu: ComputeSTUOnce(((object.geometry as BufferGeometry).attributes.position as BufferAttribute).array, orginalBounding)\r\n        }\r\n    )\r\n}\r\n\r\nconst loader = new GLTFLoader()\r\nlet lastHepler: THREE.BoxHelper | null = null\r\nconst loadModel = (path:string, scale: number)=>{\r\n    loader.load(path, (m)=>{\r\n        if(objectScene) {\r\n            scene.remove(objectScene);\r\n        }\r\n        currentScale = scale\r\n        orginalBounding.setFromObject(m.scene)\r\n        m.scene.scale.set(scale, scale, scale)\r\n        scene.add(m.scene)\r\n        objectScene = m.scene\r\n        STUs = []\r\n        \r\n        m.scene.traverse(object=>{\r\n            if(object instanceof Mesh) {\r\n                if(object.geometry instanceof BufferGeometry) {\r\n                    ComputeSTUOnceObj(object);\r\n                }\r\n            }\r\n        })\r\n        if(lastHepler) scene.remove(lastHepler)\r\n\r\n        let helper = new THREE.BoxHelper(m.scene, new THREE.Color(0xaa3348));\r\n        helper.update();\r\n        scene.add(helper); \r\n        lastHepler = helper\r\n        UpdateCtrlPoints(dimensions)\r\n    })\r\n}\r\n\r\nconst changeScene = (what:string)=>{\r\n    if(what === 'book') {\r\n        loadModel('./book/scene.gltf', 0.1)\r\n    }\r\n    else if(what === 'car') {\r\n        loadModel('./car/scene.gltf', 0.003);\r\n    }\r\n    else {\r\n        if(lastHepler) scene.remove(lastHepler)\r\n        if(objectScene) scene.remove(objectScene);\r\n        const material = new THREE.MeshPhysicalMaterial( {color: 0x2194ce, metalness: 0.5, roughness: 0.6 } );\r\n        let geometry: THREE.BufferGeometry | null = null\r\n        if(what === 'sphere') {\r\n            geometry = new THREE.SphereBufferGeometry( 0.5, 64, 64 );\r\n        }\r\n        else if (what === 'cube') {\r\n            geometry = new THREE.BoxBufferGeometry(1, 1, 1, 8, 8, 8);\r\n        }\r\n        else if(what === 'cylinder') {\r\n            geometry = new THREE.CylinderBufferGeometry( 0.5, 0.5, 1, 32 );\r\n        }\r\n        else if(what === 'donut') {\r\n            geometry = new THREE.TorusBufferGeometry( 0.5, 0.25, 16, 100 );\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n        const mesh = new THREE.Mesh( geometry, material );\r\n        orginalBounding.setFromObject(mesh);\r\n        objectScene = mesh\r\n        UpdateCtrlPoints(dimensions)\r\n        STUs=[]\r\n        ComputeSTUOnceObj(mesh)\r\n        currentScale = 1\r\n        scene.add( mesh );\r\n    }\r\n    \r\n}\r\n\r\nchangeScene('book')\r\ncontrol.attachCallback()\r\n\r\nreturn {\r\n    updateCtrlDims: (x:number, y:number, z:number)=> UpdateCtrlPoints(new THREE.Vector3(x, y, z)),\r\n    updateScene: (x:string)=>changeScene(x),\r\n    reset: ()=>{ UpdateCtrlPoints(dimensions); ffd(); }\r\n}\r\n\r\n}","\r\nimport React, { useRef, useEffect } from 'react';\r\nimport Slider from '@material-ui/core/Slider';\r\nimport { withStyles, makeStyles } from '@material-ui/core/styles';\r\n\r\nexport const PrettoSlider = withStyles({\r\n    root: {\r\n      color: '#52af77',\r\n      height: 8,\r\n    },\r\n    thumb: {\r\n      height: 24,\r\n      width: 24,\r\n      backgroundColor: '#fff',\r\n      border: '2px solid currentColor',\r\n      marginTop: -8,\r\n      marginLeft: -12,\r\n      '&:focus,&:hover,&$active': {\r\n        boxShadow: 'inherit',\r\n      },\r\n    },\r\n    active: {},\r\n    valueLabel: {\r\n      left: 'calc(-50% + 4px)',\r\n    },\r\n    track: {\r\n      height: 8,\r\n      borderRadius: 4,\r\n    },\r\n    rail: {\r\n      height: 8,\r\n      borderRadius: 4,\r\n    },\r\n  })(Slider);\r\n\r\n\r\nexport const useStyles = makeStyles(theme => ({\r\n    root: {\r\n      flexGrow: 1,\r\n    },\r\n    Right: {\r\n        maxHeight: '100vh',\r\n        overflowY: 'scroll',\r\n        paddingLeft: 20,\r\n        paddingTop: theme.spacing(2)\r\n    },\r\n    slider: {\r\n        display: 'inline'\r\n    },\r\n    sliderGroup:{\r\n      marginTop: theme.spacing(3)\r\n    }\r\n}))\r\n\r\nconst FixedMaxWidth:React.FC =  (props)=>{\r\n    const thediv = useRef<HTMLDivElement>(null)\r\n    const wrap = useRef<HTMLDivElement>(null)\r\n    useEffect(()=>{\r\n        if(thediv.current && wrap.current) {\r\n            thediv.current.style.width = wrap.current.style.width\r\n        }\r\n      \r\n    }, [])\r\n    return(\r\n      <div ref={wrap} className='canvas-frame-wrapper'>\r\n        <div ref={thediv} id=\"canvas-frame\" className=\"canvas-frame\"></div>\r\n        {props.children}\r\n      </div>\r\n    )\r\n  }\r\n\r\nexport { FixedMaxWidth }\r\n","import React, { useState } from 'react';\nimport './App.css';\nimport Render from './render'\n\nimport { PrettoSlider, useStyles, FixedMaxWidth } from './bits'\nimport Grid from '@material-ui/core/Grid'\nimport Typography from '@material-ui/core/Typography';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\n\nconst Labels = [\n  'Lattice X', 'Lattice Y', 'Lattice Z'\n] as const\n\nconst Selects = [\n  'book', 'car', 'sphere', 'cube', 'donut'\n] as const\n\nconst App: React.FC = () => {\n  const classes = useStyles()\n  const [ctrlPointsDims, setCtrlPointsDims] = useState<[number, number, number]>([2, 2, 2])\n  const [scene, setScene] = useState(0)\n  return (\n    <div className=\"App\">\n      <Grid container className={classes.root}>\n        <Grid item xs={9}>\n        <FixedMaxWidth>\n        <Render \n          ctrlPointsDims={ctrlPointsDims}\n          scene={Selects[scene]}\n        />\n        </FixedMaxWidth>\n      </Grid>\n      <Grid item xs={3} className={classes.Right}>\n\n      <FormControl variant=\"filled\" fullWidth>\n        <InputLabel htmlFor=\"filled-scene\">Scene</InputLabel>\n        <Select\n          value={scene}\n          onChange={(e: any)=>setScene(e.target.value)}\n          inputProps={{\n            name: 'scene',\n            id: 'filled-scene',\n          }}\n        >\n          {\n            Selects.map((v, idx)=>{return (\n              <MenuItem key={idx} value={idx}>{v}</MenuItem>\n            )})\n          }\n        </Select>\n      </FormControl>\n        <div className={classes.sliderGroup}>\n        {\n          ctrlPointsDims.map((v, idx)=>{return (\n            <div style={{textAlign:'left'}} key={idx}>\n            <Typography display='inline'>\n              {Labels[idx]}\n            </Typography>\n            <PrettoSlider \n              valueLabelDisplay=\"auto\" \n              \n              onChangeCommitted={(e:any, val)=>{\n                const arr = [...ctrlPointsDims] as [number, number, number]\n                arr[idx] = Number(val)\n                setCtrlPointsDims(arr)\n              }} \n              defaultValue={2} \n              min={1} max={10}\n            />\n            </div>\n          )})\n        }\n        </div>\n      </Grid>\n      </Grid>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}